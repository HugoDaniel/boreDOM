var F=async e=>{let t=new Map;for(let n=0;n<e.length;++n){let o=Array.from(Q("script[src]")).find(s=>((s.getAttribute("src")??"").split("/").pop()??"")===`${e[n]}.js`)?.getAttribute("src"),i=null;if(o)try{let l=await import(new URL(o,document.baseURI).href);for(let c of Object.keys(l)){i=l[c];break}t.set(e[n],i)}catch(s){console.error(`Unable to import "${o}"`,s)}}return t},z=()=>Array.from(Q("template[data-component]")).filter(e=>e instanceof HTMLElement).map(e=>{let t={name:"",attributes:[]};for(let n in e.dataset)n==="component"?t.name=e.dataset[n]??"":t.attributes.push([he(n),e.dataset[n]??""]);if(t.name==="")throw new Error(`A <template> was found with an invalid data-component: "${e.dataset.component}"`);return t}).map(({name:e,attributes:t})=>(V(e,{attributes:t}),e)),H=(e,t)=>{let n=w(e);if(!M(n)){let r=`The tag name "${e}" is not a BoreDOM  component.
      
"createComponent" only accepts tag-names with matching <template> tags that have a data-component attribute in them.`;throw console.error(r),new Error(r)}return t&&(n.renderCallback=t),n},ge=e=>{let t=J(e);if(!(t===null||!M(t)))return t},J=e=>document.querySelector(e),Q=e=>document.querySelectorAll(e),w=(e,t)=>{let n=document.createElement(e);return t&&Array.isArray(t)&&t.length>0&&t.map(r=>n.appendChild(r)),n};var ye=(e,t)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(e,{detail:t}))):dispatchEvent(new CustomEvent(e,{detail:t}))};var K=e=>typeof e=="object",N=e=>typeof e=="function",M=e=>K(e)&&"isBored"in e&&!!e.isBored;var he=e=>{if(e===""||!e.split("").some(n=>n!==n.toLowerCase()))return e;let t="";for(let n=0;n<e.length;n++){let r=e[n];r===r.toUpperCase()&&n!==0&&(t+="-"),t+=r.toLowerCase()}return t};var B=e=>e.startsWith("on"),be=e=>e.startsWith("queriedOn"),$=e=>B(e)?e.slice(2).toLowerCase():e.slice(9).toLowerCase(),k=class extends HTMLElement{},V=(e,t={})=>{customElements.get(e)||customElements.define(e,class extends k{static get observedAttributes(){return typeof t.attributeChangedCallback=="object"?Object.keys(t.attributeChangedCallback):[]}constructor(){super()}isBored=!0;traverse(n,{traverseShadowRoot:r,query:a}={}){Array.from(r?this.shadowRoot?.querySelectorAll(a??"*")??[]:[]).concat(Array.from(this.querySelectorAll(a??"*"))).filter(o=>o instanceof HTMLElement).forEach(n)}#e(n){return n.split("'").filter(r=>r.length>2&&!(r.includes("(")||r.includes(",")||r.includes(")")))}#t(){let n;this.traverse(r=>{if(r instanceof HTMLElement){customElements.get(r.tagName.toLowerCase())&&(n=r);for(let o=0;o<r.attributes.length;o++){let i=r.attributes[o];if(B(i.name)){let s=this.#e(i.value);s.length>0&&s.forEach(l=>{r.addEventListener($(i.name),c=>ye(l,{event:c,dispatcher:r,component:this,index:this.parentElement?Array.from(this.parentElement.children).indexOf(this):-1}))}),r.setAttribute(`data-${i.name}-dispatches`,s.join()),r.removeAttribute(i.name)}}}},{traverseShadowRoot:!0})}isInitialized=!1;#n(){let n=J(`[data-component="${e}"]`)??w("template"),r=n.getAttribute("shadowrootmode");if(t.style||t.shadow||r){let o=t.shadowrootmode??r??"open",i=this.attachShadow({mode:o});if(t.style){let s=w("style");s.textContent=t.style,i.appendChild(s)}if(t.shadow){let s=w("template");s.innerHTML=t.shadow,i.appendChild(s.content.cloneNode(!0))}else r&&i.appendChild(n.content.cloneNode(!0))}n&&!r&&this.appendChild(n.content.cloneNode(!0)),t.onSlotChange&&this.traverse(o=>{o instanceof HTMLSlotElement&&o.addEventListener("slotchange",i=>t.onSlotChange?.(i))},{traverseShadowRoot:!0}),N(t.onClick)&&this.addEventListener("click",t.onClick);for(let[o,i]of Object.entries(t))if(B(o)){if(!N(i))continue;this.addEventListener($(o),i)}else if(be(o)){let s=i;if(!K(s))continue;let l=$(o);for(let[c,f]of Object.entries(s))this.traverse(u=>{u.addEventListener(l,f)},{traverseShadowRoot:!0,query:c})}t.attributes&&Array.isArray(t.attributes)&&t.attributes.map(([o,i])=>this.setAttribute(o,i)),this.#t(),this.isInitialized=!0}renderCallback=n=>{};connectedCallback(){this.isInitialized||this.#n(),this.renderCallback(this),t.connectedCallback?.(this)}slots=D(this);updateSlot(n,r,a){document.createElement(a).setAttribute("slot",n)}disconnectedCallback(){t.disconnectedCallback?.(this)}adoptedCallback(){t.adoptedCallback?.(this)}attributeChangedCallback(n,r,a){t.attributeChangedCallback&&t.attributeChangedCallback[n]({element:this,name:n,oldValue:r,newValue:a})}})},R=e=>{V(e,{})};function X(e,t){let n=t;return t===null||e.forEach(r=>{n=n[r]}),n}function Y(e,t=[]){let n=[{path:[],obj:e}],r=[];for(;n.length>0;){let{path:a,obj:o}=n.pop();for(let i in o){if(t.includes(i))continue;let s=o[i],l=a.concat(i);typeof s=="object"&&s!==null&&n.push({path:l,obj:s}),r.push({path:l,value:s})}}return r}function E(e){if(e==null||typeof e!="object")return!1;let t=Object.getPrototypeOf(e);return t==null?!0:t===Object.prototype}function Z(e,t,n){return(r,a)=>{addEventListener(r,o=>{let i=o?.detail?.event.currentTarget,s;for(;i;){if(i===e){try{let l=a({state:t,e:o.detail,detail:n});Promise.resolve(l).catch(c=>{console.error(`Error in async handler for "${r}" event`,c)})}catch(l){console.error(`Error in handler for "${r}" event`,l)}return}i instanceof HTMLElement?i=i.parentElement:i=void 0}})}}function ee(e){return new Proxy({},{get(t,n,r){let a=new Error(`Ref "${String(n)}" not found in <${e.tagName}>`);if(typeof n=="string"){let o=e.querySelectorAll(`[data-ref="${n}"]`);if(!o)throw a;let i=Array.from(o).filter(s=>s instanceof HTMLElement);if(i.length===0)throw a;return i.length===1?i[0]:i}}})}function D(e){return new Proxy({},{get(t,n,r){let a=new Error(`Slot "${String(n)}" not found in <${e.tagName}>`);if(typeof n=="string"){let o=e.querySelectorAll(`slot[name="${n}"]`);if(!o)throw a;let i=Array.from(o).filter(s=>s instanceof HTMLSlotElement);if(i.length===0)throw a;return i.length===1?i[0]:i}},set(t,n,r){if(typeof n!="string")return!1;let a=r;if(r instanceof HTMLElement)r.setAttribute("data-slot",n);else if(typeof r=="string")a=w("span"),a.setAttribute("data-slot",n),a.innerText=r;else throw new Error(`Invalid value for slot ${n} in <${e.tagName}>`);let o=Array.from(e.querySelectorAll(`[data-slot="${n}"]`));return o.length>0?o.forEach(i=>i.parentElement?.replaceChild(a,i)):Array.from(e.querySelectorAll(`slot[name="${n}"]`)).forEach(s=>s.parentElement?.replaceChild(a,s)),!0}})}function I(e,t,n){let r=n||{targets:new WeakMap,path:[]};if(e!==void 0)return new Proxy(e,{set(a,o,i){return typeof o=="string"&&console.error(`State is read-only for web components. Unable to set '${o}'.`),!1},get(a,o,i){let s=Reflect.get(a,o,i),l=o==="__proto__";if(typeof o=="string"&&!l&&(r.targets.has(a)||(r.targets.set(a,r.path.join(".")),r.path.push(o))),l||Array.isArray(s)||E(s))return I(s,t,r);let c=r.targets.get(a)??"";return typeof c=="string"&&typeof o=="string"&&(Array.isArray(a)||(c+=c!==""?`.${o}`:o),t.indexOf(c)===-1&&t.push(c)),r.path.length=0,r.path.push(c),s}})}function Ee(e){return()=>{let t=e.internal.updates,n=new Set,r=a=>{if(a)for(let o=0;o<a.length;o++){let i=a[o];if(!n.has(i)){n.add(i);try{i(e.app)}catch{}}}};for(let a=0;a<t.path.length;a++){let o=t.path[a],i=o.slice(o.indexOf(".")+1);r(t.subscribers.get(i));for(let[s,l]of t.subscribers.entries()){if(s===i)continue;let c=`${s}.`,f=`${i}.`;(i.startsWith(c)||s.startsWith(f))&&r(l)}}t.path=[],t.value=[],t.raf=void 0}}function te(e){let t=e.internal,n=e;if(n===void 0)return e;let r=new WeakSet,a=Symbol("boredom-proxy");function o(s,l){if(r.has(s))return s;let c=new Proxy(s,{get(f,u,p){return u===a?!0:Reflect.get(f,u,p)},set(f,u,p){if(!(f[u]!==p))return!0;if(typeof u=="string"){let x=Array.isArray(s)?l:`${l}.${u}`;!(p&&p[a]===!0)&&(Array.isArray(p)||E(p))&&(p=i(p,x))}return Reflect.set(f,u,p),typeof u!="string"||(Array.isArray(s)?t.updates.path.push(`${l}`):t.updates.path.push(`${l}.${u}`),t.updates.value.push(f),t.updates.raf||(t.updates.raf=requestAnimationFrame(Ee(e)))),!0}});return r.add(s),r.add(c),c}function i(s,l){if(!Array.isArray(s)&&!E(s)||r.has(s)||s&&s[a]===!0)return s;if(Array.isArray(s))for(let c=0;c<s.length;c++){let f=s[c];(Array.isArray(f)||E(f))&&(s[c]=i(f,l))}else for(let c of Object.keys(s)){let f=s[c];(Array.isArray(f)||E(f))&&(s[c]=i(f,`${l}.${c}`))}return o(s,l)}return Y(e,["internal"]).forEach(({path:s,value:l})=>{if(Array.isArray(l)||E(l)&&!r.has(l)){let f=s.join("."),u=X(s.slice(0,-1),n);if(u===l)return;u[s.at(-1)]=o(l,f)}}),e}function ne(e){let t=e.internal.customTags.filter(r=>document.querySelector(r)!==null),n=e.internal.components;for(let[r,a]of n.entries()){if(a===null||!t.includes(r))continue;let o=Array.from(document.querySelectorAll(r)).filter(i=>M(i));o.length!==0&&o.forEach((i,s)=>{a(e,{index:s,name:r,data:void 0})(i)})}}function U(e,t,n){let r=t.internal.components.get(e);if(r){let a={...n,tagName:e};return H(e,r(t,a))}return H(e)}var A={console:!0,globals:!0,errorBoundary:!0,visualIndicators:!0,errorHistory:!0,versionLog:!0,api:!0},S=new Map,m=null;function d(e){return typeof __DEBUG__<"u"&&!__DEBUG__?e==="errorBoundary"?A.errorBoundary??!0:!1:A[e]??!0}function W(e){if(typeof e=="boolean"){let t=e;A={console:t,globals:t,errorBoundary:!0,visualIndicators:t,errorHistory:t,versionLog:t,api:t}}else A={...A,...e}}function Se(){return{...A}}function re(e){if(typeof __DEBUG__<"u"&&!__DEBUG__||!d("globals")||typeof window>"u")return;let t=window;t.$state=e.state,t.$refs=e.refs,t.$slots=e.slots,t.$self=e.element,t.$error=e.error,t.$component=e.component,t.$rerender=e.rerender}function oe(){if(typeof __DEBUG__<"u"&&!__DEBUG__||!d("globals")||typeof window>"u")return;let e=window;delete e.$state,delete e.$refs,delete e.$slots,delete e.$self,delete e.$error,delete e.$component,delete e.$rerender}function ie(e){typeof __DEBUG__<"u"&&!__DEBUG__||d("console")&&(console.log("%c\u{1F534} boreDOM: Error in %c<%s>%c render","color: #ff6b6b; font-weight: bold","color: #4ecdc4; font-weight: bold",e.component,"color: #ff6b6b"),console.error(e.error),d("globals")&&(console.log("%c\u{1F4CB} Debug context loaded:","color: #95a5a6; font-weight: bold"),console.log("   $state     \u2192",e.state),console.log("   $refs      \u2192",e.refs),console.log("   $slots     \u2192",e.slots),console.log("   $self      \u2192",e.element),console.log("%c\u{1F4A1} Quick fixes:","color: #f39c12; font-weight: bold"),console.log("   $state.propertyName = value"),console.log("   $rerender()"),console.log("%c\u{1F4E4} When fixed:","color: #27ae60; font-weight: bold"),console.log(`   boreDOM.export('${e.component}')`)))}function se(e,t){console.error(`[boreDOM] Render error in <${e}>: ${t.message}`)}function ae(e,t){typeof __DEBUG__<"u"&&!__DEBUG__||d("console")&&(console.log("%c\u{1F534} boreDOM: Error in %c<%s>%c init","color: #ff6b6b; font-weight: bold","color: #4ecdc4; font-weight: bold",e,"color: #ff6b6b"),console.error(t))}function le(e){typeof __DEBUG__<"u"&&!__DEBUG__||d("errorHistory")&&(S.set(e.component,e),m=e)}function j(e){e?(S.delete(e),m?.component===e&&(m=null)):m&&(S.delete(m.component),m=null)}function ce(e){typeof __DEBUG__<"u"&&!__DEBUG__||d("visualIndicators")&&e.setAttribute("data-boredom-error","true")}function G(e){e.removeAttribute("data-boredom-error")}function Ce(e){let t=e?S.get(e):m;if(!t)return null;try{return{component:t.component,state:JSON.parse(JSON.stringify(t.state)),timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}catch{return{component:t.component,state:"[Unable to serialize - contains circular references or functions]",timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}}var C={get errors(){return S},get lastError(){return m},rerender(e){let t=e?S.get(e):m;t?t.rerender():console.warn("[boreDOM] No error context found to rerender")},clearError(e){let t=e?S.get(e):m;t&&(G(t.element),j(e),oe())},export:Ce,get config(){return Se()}};var _=null,P=null,q=null,fe=new WeakMap;function de(e,t,n){_=e,t&&(P=t),n&&(q=n)}function ue(e,t){typeof __DEBUG__<"u"&&!__DEBUG__||d("api")&&fe.set(e,t)}function xe(e){return typeof e=="function"&&e.length===2}function we(e,t,n){if(typeof __DEBUG__<"u"&&!__DEBUG__){console.warn("[boreDOM] define() is not available in production build");return}if(!d("api")){console.warn("[boreDOM] define() is disabled (debug.api is false)");return}if(!_)throw new Error("[boreDOM] Cannot define component before inflictBoreDOM()");if(!e.includes("-"))throw new Error(`[boreDOM] Invalid tag name "${e}": must contain a hyphen`);if(customElements.get(e))throw new Error(`[boreDOM] Component "${e}" is already defined`);if(!P||!q)throw new Error("[boreDOM] Console API not initialized. Call inflictBoreDOM() first.");let r=document.createElement("template");r.innerHTML=t,r.setAttribute("data-component",e),document.body.appendChild(r);let a=xe(n)?n:P(n);_.internal.components.set(e,a),_.internal.customTags.push(e),q(e),Ae(e,a),d("console")&&console.log("%c\u2705 boreDOM: Defined %c<%s>","color: #27ae60; font-weight: bold","color: #4ecdc4; font-weight: bold",e)}function Ae(e,t){if(!_)return;Array.from(document.querySelectorAll(e)).forEach((r,a)=>{if(r instanceof HTMLElement&&"renderCallback"in r){let i=t(_,{index:a,name:e,data:void 0});r.renderCallback=i,i(r)}})}function pe(e,t=0){if(typeof __DEBUG__<"u"&&!__DEBUG__||!d("api"))return;let n=null;if(typeof e=="string"?n=Array.from(document.querySelectorAll(e)).filter(o=>o instanceof HTMLElement)[t]??null:n=e,!n){d("console")&&console.warn(`[boreDOM] operate(): No element found for "${e}"`);return}let r=fe.get(n);if(!r){d("console")&&console.warn("[boreDOM] operate(): Element is not a boreDOM component or not initialized");return}return r}function _e(e){if(typeof __DEBUG__<"u"&&!__DEBUG__||!d("api"))return null;let t=pe(e);if(!t)return null;let r=document.querySelector(`template[data-component="${t.detail.name}"]`)?.innerHTML??void 0;try{return{component:t.detail.name,state:JSON.parse(JSON.stringify(t.state)),template:r,timestamp:new Date().toISOString()}}catch{return{component:t.detail.name,state:"[Unable to serialize - contains circular references or functions]",template:r,timestamp:new Date().toISOString()}}}var v={define:we,operate:pe,exportComponent:_e};var L="0.25.25";var me=!1,Me={get errors(){return C.errors},get lastError(){return C.lastError},rerender:C.rerender,clearError:C.clearError,export:C.export,get config(){return C.config},version:L,define:v.define,operate:v.operate,exportComponent:v.exportComponent};typeof window<"u"&&(window.boreDOM=Me);async function Ye(e,t,n){n?.debug!==void 0&&W(n.debug),!me&&d("versionLog")&&(me=!0,typeof console<"u"&&typeof console.info=="function"&&console.info(`[boreDOM] v${L}`));let r=z(),a=await F(r);if(t)for(let s of Object.keys(t))a.set(s,t[s]);let i=te({app:e,internal:{customTags:r,components:a,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return i.internal.updates.path=[],i.internal.updates.value=[],i.internal.updates.raf&&(cancelAnimationFrame(i.internal.updates.raf),i.internal.updates.raf=void 0),de(i,De,R),ne(i),i.app}function De(e){let t=null,n;return(r,a)=>o=>{let{internal:i,app:s}=r,l=[],c=I(s,l),f=ee(o),u=D(o),p=Z(o,s,a);if(t!==o){let O=async()=>{let g=i.updates.subscribers;for(let h of l){let y=g.get(h);y?y.includes(n)||y.push(n):g.set(h,[n])}},x;try{x=e({detail:a,state:c,refs:f,on:p,self:o})}catch(g){let h=g;d("console")&&ae(a?.name??o.tagName.toLowerCase(),h),x=()=>{}}n=g=>{let h=a?.name??o.tagName.toLowerCase();if(d("errorBoundary"))try{x({state:g,refs:f,slots:u,self:o,detail:a,makeComponent:(y,b)=>U(y,r,b?.detail)}),O(),G(o),j(h)}catch(y){let b=y,T={component:h,element:o,error:b,state:s,refs:f,slots:u,timestamp:Date.now(),rerender:()=>n(g),stack:b.stack??""};d("console")?ie(T):se(h,b),re(T),le(T),ce(o)}else x({state:g,refs:f,slots:u,self:o,detail:a,makeComponent:(y,b)=>U(y,r,b?.detail)}),O()},ue(o,{state:s,refs:f,slots:u,self:o,detail:a,rerender:()=>n(s)})}n(c),t=o}}export{L as VERSION,Me as boreDOM,oe as clearGlobals,Ye as inflictBoreDOM,d as isDebugEnabled,ge as queryComponent,R as registerComponent,W as setDebugConfig,De as webComponent};
