var J=async e=>{let t=new Map;for(let n=0;n<e.length;++n){let s=Array.from(V("script[src]")).find(i=>((i.getAttribute("src")??"").split("/").pop()??"")===`${e[n]}.js`)?.getAttribute("src"),r=null;if(s)try{let l=await import(new URL(s,document.baseURI).href);for(let c of Object.keys(l)){r=l[c];break}t.set(e[n],r)}catch(i){console.error(`Unable to import "${s}"`,i)}}return t},Q=()=>Array.from(V("template[data-component]")).filter(e=>e instanceof HTMLElement).map(e=>{let t={name:"",attributes:[]};for(let n in e.dataset)n==="component"?t.name=e.dataset[n]??"":t.attributes.push([Ee(n),e.dataset[n]??""]);if(t.name==="")throw new Error(`A <template> was found with an invalid data-component: "${e.dataset.component}"`);return t}).map(({name:e,attributes:t})=>(Y(e,{attributes:t}),e)),H=(e,t)=>{let n=x(e);if(!D(n)){let o=`The tag name "${e}" is not a BoreDOM  component.
      
"createComponent" only accepts tag-names with matching <template> tags that have a data-component attribute in them.`;throw console.error(o),new Error(o)}return t&&(n.renderCallback=t),n},be=e=>{let t=K(e);if(!(t===null||!D(t)))return t},K=e=>document.querySelector(e),V=e=>document.querySelectorAll(e),x=(e,t)=>{let n=document.createElement(e);return t&&Array.isArray(t)&&t.length>0&&t.map(o=>n.appendChild(o)),n};var he=(e,t)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(e,{detail:t}))):dispatchEvent(new CustomEvent(e,{detail:t}))};var X=e=>typeof e=="object",F=e=>typeof e=="function",D=e=>X(e)&&"isBored"in e&&!!e.isBored;var Ee=e=>{if(e===""||!e.split("").some(n=>n!==n.toLowerCase()))return e;let t="";for(let n=0;n<e.length;n++){let o=e[n];o===o.toUpperCase()&&n!==0&&(t+="-"),t+=o.toLowerCase()}return t};var B=e=>e.startsWith("on"),Se=e=>e.startsWith("queriedOn"),$=e=>B(e)?e.slice(2).toLowerCase():e.slice(9).toLowerCase(),k=class extends HTMLElement{},Y=(e,t={})=>{customElements.get(e)||customElements.define(e,class extends k{static get observedAttributes(){return typeof t.attributeChangedCallback=="object"?Object.keys(t.attributeChangedCallback):[]}constructor(){super()}isBored=!0;traverse(n,{traverseShadowRoot:o,query:a}={}){Array.from(o?this.shadowRoot?.querySelectorAll(a??"*")??[]:[]).concat(Array.from(this.querySelectorAll(a??"*"))).filter(s=>s instanceof HTMLElement).forEach(n)}#e(n){return n.split("'").filter(o=>o.length>2&&!(o.includes("(")||o.includes(",")||o.includes(")")))}#t(){let n;this.traverse(o=>{if(o instanceof HTMLElement){customElements.get(o.tagName.toLowerCase())&&(n=o);for(let s=0;s<o.attributes.length;s++){let r=o.attributes[s];if(B(r.name)){let i=this.#e(r.value);i.length>0&&i.forEach(l=>{o.addEventListener($(r.name),c=>he(l,{event:c,dispatcher:o,component:this,index:this.parentElement?Array.from(this.parentElement.children).indexOf(this):-1}))}),o.setAttribute(`data-${r.name}-dispatches`,i.join()),o.removeAttribute(r.name)}}}},{traverseShadowRoot:!0})}isInitialized=!1;#n(){let n=K(`[data-component="${e}"]`)??x("template"),o=n.getAttribute("shadowrootmode");if(t.style||t.shadow||o){let s=t.shadowrootmode??o??"open",r=this.attachShadow({mode:s});if(t.style){let i=x("style");i.textContent=t.style,r.appendChild(i)}if(t.shadow){let i=x("template");i.innerHTML=t.shadow,r.appendChild(i.content.cloneNode(!0))}else o&&r.appendChild(n.content.cloneNode(!0))}n&&!o&&this.appendChild(n.content.cloneNode(!0)),t.onSlotChange&&this.traverse(s=>{s instanceof HTMLSlotElement&&s.addEventListener("slotchange",r=>t.onSlotChange?.(r))},{traverseShadowRoot:!0}),F(t.onClick)&&this.addEventListener("click",t.onClick);for(let[s,r]of Object.entries(t))if(B(s)){if(!F(r))continue;this.addEventListener($(s),r)}else if(Se(s)){let i=r;if(!X(i))continue;let l=$(s);for(let[c,d]of Object.entries(i))this.traverse(u=>{u.addEventListener(l,d)},{traverseShadowRoot:!0,query:c})}t.attributes&&Array.isArray(t.attributes)&&t.attributes.map(([s,r])=>this.setAttribute(s,r)),this.#t(),this.isInitialized=!0}renderCallback=n=>{};connectedCallback(){this.isInitialized||this.#n(),this.renderCallback(this),t.connectedCallback?.(this)}slots=O(this);updateSlot(n,o,a){document.createElement(a).setAttribute("slot",n)}disconnectedCallback(){t.disconnectedCallback?.(this)}adoptedCallback(){t.adoptedCallback?.(this)}attributeChangedCallback(n,o,a){t.attributeChangedCallback&&t.attributeChangedCallback[n]({element:this,name:n,oldValue:o,newValue:a})}})},R=e=>{Y(e,{})};function Z(e,t){let n=t;return t===null||e.forEach(o=>{n=n[o]}),n}function ee(e,t=[]){let n=[{path:[],obj:e}],o=[],a=new WeakSet;for(;n.length>0;){let{path:s,obj:r}=n.pop();if(!a.has(r)){a.add(r);for(let i in r){if(t.includes(i))continue;let l=r[i],c=s.concat(i);typeof l=="object"&&l!==null&&!a.has(l)&&n.push({path:c,obj:l}),o.push({path:c,value:l})}}}return o}function E(e){if(e==null||typeof e!="object")return!1;let t=Object.getPrototypeOf(e);return t==null?!0:t===Object.prototype}function te(e,t,n){return(o,a)=>{addEventListener(o,s=>{let r=s?.detail?.event.currentTarget,i;for(;r;){if(r===e){try{let l=a({state:t,e:s.detail,detail:n});Promise.resolve(l).catch(c=>{console.error(`Error in async handler for "${o}" event`,c)})}catch(l){console.error(`Error in handler for "${o}" event`,l)}return}r instanceof HTMLElement?r=r.parentElement:r=void 0}})}}function ne(e){return new Proxy({},{get(t,n,o){let a=new Error(`Ref "${String(n)}" not found in <${e.tagName}>`);if(typeof n=="string"){let s=e.querySelectorAll(`[data-ref="${n}"]`);if(!s)throw a;let r=Array.from(s).filter(i=>i instanceof HTMLElement);if(r.length===0)throw a;return r.length===1?r[0]:r}}})}function O(e){return new Proxy({},{get(t,n,o){let a=new Error(`Slot "${String(n)}" not found in <${e.tagName}>`);if(typeof n=="string"){let s=e.querySelectorAll(`slot[name="${n}"]`);if(!s)throw a;let r=Array.from(s).filter(i=>i instanceof HTMLSlotElement);if(r.length===0)throw a;return r.length===1?r[0]:r}},set(t,n,o){if(typeof n!="string")return!1;let a=o;if(o instanceof HTMLElement)o.setAttribute("data-slot",n);else if(typeof o=="string")a=x("span"),a.setAttribute("data-slot",n),a.innerText=o;else throw new Error(`Invalid value for slot ${n} in <${e.tagName}>`);let s=Array.from(e.querySelectorAll(`[data-slot="${n}"]`));return s.length>0?s.forEach(r=>r.parentElement?.replaceChild(a,r)):Array.from(e.querySelectorAll(`slot[name="${n}"]`)).forEach(i=>i.parentElement?.replaceChild(a,i)),!0}})}function U(e,t,n){let o=n||{targets:new WeakMap,path:[]};if(e!==void 0)return new Proxy(e,{set(a,s,r){return typeof s=="string"&&console.error(`State is read-only for web components. Unable to set '${s}'.`),!1},get(a,s,r){let i=Reflect.get(a,s,r),l=s==="__proto__";if(typeof s=="string"&&!l&&(o.targets.has(a)||(o.targets.set(a,o.path.join(".")),o.path.push(s))),l||Array.isArray(i)||E(i))return U(i,t,o);let c=o.targets.get(a)??"";return typeof c=="string"&&typeof s=="string"&&(Array.isArray(a)||(c+=c!==""?`.${s}`:s),t.indexOf(c)===-1&&t.push(c)),o.path.length=0,o.path.push(c),i}})}function Ce(e){return()=>{let t=e.internal.updates,n=new Set,o=a=>{if(a)for(let s=0;s<a.length;s++){let r=a[s];if(!n.has(r)){n.add(r);try{r(e.app)}catch{}}}};for(let a=0;a<t.path.length;a++){let s=t.path[a],r=s.slice(s.indexOf(".")+1);o(t.subscribers.get(r));for(let[i,l]of t.subscribers.entries()){if(i===r)continue;let c=`${i}.`,d=`${r}.`;(r.startsWith(c)||i.startsWith(d))&&o(l)}}t.path=[],t.value=[],t.raf=void 0}}function re(e){let t=e.internal,n=e;if(n===void 0)return e;let o=new WeakSet,a=Symbol("boredom-proxy");function s(i,l){if(o.has(i))return i;let c=new Proxy(i,{get(d,u,p){return u===a?!0:Reflect.get(d,u,p)},set(d,u,p){if(!(d[u]!==p))return!0;if(typeof u=="string"){let M=Array.isArray(i)?l:`${l}.${u}`;!(p&&p[a]===!0)&&(Array.isArray(p)||E(p))&&(p=r(p,M))}return Reflect.set(d,u,p),typeof u!="string"||(Array.isArray(i)?t.updates.path.push(`${l}`):t.updates.path.push(`${l}.${u}`),t.updates.value.push(d),t.updates.raf||(t.updates.raf=requestAnimationFrame(Ce(e)))),!0}});return o.add(i),o.add(c),c}function r(i,l){if(!Array.isArray(i)&&!E(i)||o.has(i)||i&&i[a]===!0)return i;if(Array.isArray(i))for(let c=0;c<i.length;c++){let d=i[c];(Array.isArray(d)||E(d))&&(i[c]=r(d,l))}else for(let c of Object.keys(i)){let d=i[c];(Array.isArray(d)||E(d))&&(i[c]=r(d,`${l}.${c}`))}return s(i,l)}return ee(e,["internal"]).forEach(({path:i,value:l})=>{if(Array.isArray(l)||E(l)&&!o.has(l)){let d=i.join("."),u=Z(i.slice(0,-1),n);if(u===l)return;u[i.at(-1)]=s(l,d)}}),e}function oe(e){let t=e.internal.customTags.filter(o=>document.querySelector(o)!==null),n=e.internal.components;for(let[o,a]of n.entries()){if(a===null||!t.includes(o))continue;let s=Array.from(document.querySelectorAll(o)).filter(r=>D(r));s.length!==0&&s.forEach((r,i)=>{a(e,{index:i,name:o,data:void 0})(r)})}}function W(e,t,n){let o=t.internal.components.get(e);if(o){let a={...n,tagName:e};return H(e,o(t,a))}return H(e)}var w={console:!0,globals:!0,errorBoundary:!0,visualIndicators:!0,errorHistory:!0,versionLog:!0,api:!0},S=new Map,m=null;function f(e){return typeof __DEBUG__<"u"&&!__DEBUG__?e==="errorBoundary"?w.errorBoundary??!0:!1:w[e]??!0}function I(e){if(typeof e=="boolean"){let t=e;w={console:t,globals:t,errorBoundary:!0,visualIndicators:t,errorHistory:t,versionLog:t,api:t}}else w={...w,...e}}function xe(){return{...w}}function ie(e){if(typeof __DEBUG__<"u"&&!__DEBUG__||!f("globals")||typeof window>"u")return;let t=window;t.$state=e.state,t.$refs=e.refs,t.$slots=e.slots,t.$self=e.element,t.$error=e.error,t.$component=e.component,t.$rerender=e.rerender}function se(){if(typeof __DEBUG__<"u"&&!__DEBUG__||!f("globals")||typeof window>"u")return;let e=window;delete e.$state,delete e.$refs,delete e.$slots,delete e.$self,delete e.$error,delete e.$component,delete e.$rerender}function ae(e){typeof __DEBUG__<"u"&&!__DEBUG__||f("console")&&(console.log("%c\u{1F534} boreDOM: Error in %c<%s>%c render","color: #ff6b6b; font-weight: bold","color: #4ecdc4; font-weight: bold",e.component,"color: #ff6b6b"),console.error(e.error),f("globals")&&(console.log("%c\u{1F4CB} Debug context loaded:","color: #95a5a6; font-weight: bold"),console.log("   $state     \u2192",e.state),console.log("   $refs      \u2192",e.refs),console.log("   $slots     \u2192",e.slots),console.log("   $self      \u2192",e.element),console.log("%c\u{1F4A1} Quick fixes:","color: #f39c12; font-weight: bold"),console.log("   $state.propertyName = value"),console.log("   $rerender()"),console.log("%c\u{1F4E4} When fixed:","color: #27ae60; font-weight: bold"),console.log(`   boreDOM.export('${e.component}')`)))}function le(e,t){console.error(`[boreDOM] Render error in <${e}>: ${t.message}`)}function ce(e,t){typeof __DEBUG__<"u"&&!__DEBUG__||f("console")&&(console.log("%c\u{1F534} boreDOM: Error in %c<%s>%c init","color: #ff6b6b; font-weight: bold","color: #4ecdc4; font-weight: bold",e,"color: #ff6b6b"),console.error(t))}function fe(e){typeof __DEBUG__<"u"&&!__DEBUG__||f("errorHistory")&&(S.set(e.component,e),m=e)}function G(e){typeof __DEBUG__<"u"&&!__DEBUG__||f("errorHistory")&&(e?(S.delete(e),m?.component===e&&(m=null)):m&&(S.delete(m.component),m=null))}function de(e){typeof __DEBUG__<"u"&&!__DEBUG__||f("visualIndicators")&&e.setAttribute("data-boredom-error","true")}function P(e){e.removeAttribute("data-boredom-error")}function we(e){let t=e?S.get(e):m;if(!t)return null;try{return{component:t.component,state:JSON.parse(JSON.stringify(t.state)),timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}catch(n){return f("console")&&console.warn(`[boreDOM] exportState: Unable to serialize state for <${t.component}>:`,n instanceof Error?n.message:n),{component:t.component,state:"[Unable to serialize - contains circular references or functions]",timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}}var C={get errors(){return S},get lastError(){return m},rerender(e){let t=e?S.get(e):m;t?t.rerender():console.warn("[boreDOM] No error context found to rerender")},clearError(e){let t=e?S.get(e):m;t?(P(t.element),G(e),se()):f("console")&&console.warn(e?`[boreDOM] clearError: No error found for <${e}>`:"[boreDOM] clearError: No error to clear")},export:we,get config(){return xe()}};var N=Symbol("boreDOM.webComponent"),A=null,j=null,q=null,ue=new WeakMap;function pe(e,t,n){A=e,t&&(j=t),n&&(q=n)}function me(e,t){typeof __DEBUG__<"u"&&!__DEBUG__||f("api")&&ue.set(e,t)}function _e(e){return typeof e=="function"&&e[N]===!0}function Ae(e,t,n){if(typeof __DEBUG__<"u"&&!__DEBUG__)return console.warn("[boreDOM] define() is not available in production build"),!1;if(!f("api"))return console.warn("[boreDOM] define() is disabled (debug.api is false)"),!1;if(!A)throw new Error("[boreDOM] Cannot define component before inflictBoreDOM()");if(!e.includes("-"))throw new Error(`[boreDOM] Invalid tag name "${e}": must contain a hyphen`);if(customElements.get(e))throw new Error(`[boreDOM] Component "${e}" is already defined`);if(!j||!q)throw new Error("[boreDOM] Console API not initialized. Call inflictBoreDOM() first.");let o=A,a=j,s=q,r=document.createElement("template");r.innerHTML=t,r.setAttribute("data-component",e),document.body.appendChild(r);let i=_e(n)?n:a(n);return o.internal.components.set(e,i),o.internal.customTags.push(e),s(e),Me(e,i),f("console")&&console.log("%c\u2705 boreDOM: Defined %c<%s>","color: #27ae60; font-weight: bold","color: #4ecdc4; font-weight: bold",e),!0}function Me(e,t){if(!A)return;let n=Array.from(document.querySelectorAll(e)),o={count:0};n.forEach((a,s)=>{if(a instanceof HTMLElement&&"renderCallback"in a)try{let i=t(A,{index:s,name:e,data:void 0});a.renderCallback=i,i(a)}catch(r){o.count++,f("console")&&console.error(`[boreDOM] Failed to initialize <${e}> instance ${s}:`,r)}}),o.count>0&&f("console")&&console.warn(`[boreDOM] ${o.count} of ${n.length} <${e}> instances failed to initialize`)}function ye(e,t=0){if(typeof __DEBUG__<"u"&&!__DEBUG__){console.warn("[boreDOM] operate() is not available in production build");return}if(!f("api")){console.warn("[boreDOM] operate() is disabled (debug.api is false)");return}let n=null;if(typeof e=="string"?n=Array.from(document.querySelectorAll(e)).filter(s=>s instanceof HTMLElement)[t]??null:n=e,!n){f("console")&&console.warn(`[boreDOM] operate(): No element found for "${e}"`);return}let o=ue.get(n);if(!o){f("console")&&console.warn("[boreDOM] operate(): Element is not a boreDOM component or not initialized");return}return o}function De(e){if(typeof __DEBUG__<"u"&&!__DEBUG__)return console.warn("[boreDOM] exportComponent() is not available in production build"),null;if(!f("api"))return console.warn("[boreDOM] exportComponent() is disabled (debug.api is false)"),null;let t=ye(e);if(!t)return null;let o=document.querySelector(`template[data-component="${t.detail.name}"]`)?.innerHTML??void 0;try{return{component:t.detail.name,state:JSON.parse(JSON.stringify(t.state)),template:o,timestamp:new Date().toISOString()}}catch(a){return f("console")&&console.warn(`[boreDOM] exportComponent: Unable to serialize state for <${t.detail.name}>:`,a instanceof Error?a.message:a),{component:t.detail.name,state:"[Unable to serialize - contains circular references or functions]",template:o,timestamp:new Date().toISOString()}}}var v={define:Ae,operate:ye,exportComponent:De};var L="0.25.25";var ge=!1,Oe={get errors(){return C.errors},get lastError(){return C.lastError},rerender:C.rerender,clearError:C.clearError,export:C.export,get config(){return C.config},version:L,define:v.define,operate:v.operate,exportComponent:v.exportComponent};typeof window<"u"&&(window.boreDOM=Oe);async function et(e,t,n){n?.debug!==void 0&&I(n.debug),!ge&&f("versionLog")&&(ge=!0,typeof console<"u"&&typeof console.info=="function"&&console.info(`[boreDOM] v${L}`));let o=Q(),a=await J(o);if(t)for(let i of Object.keys(t))a.set(i,t[i]);let r=re({app:e,internal:{customTags:o,components:a,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return r.internal.updates.path=[],r.internal.updates.value=[],r.internal.updates.raf&&(cancelAnimationFrame(r.internal.updates.raf),r.internal.updates.raf=void 0),pe(r,ve,R),oe(r),r.app}function ve(e){let t=null,n,o=(a,s)=>r=>{let{internal:i,app:l}=a,c=[],d=U(l,c),u=ne(r),p=O(r),z=te(r,l,s);if(t!==r){let M=async()=>{let g=i.updates.subscribers;for(let b of c){let y=g.get(b);y?y.includes(n)||y.push(n):g.set(b,[n])}},_;try{_=e({detail:s,state:d,refs:u,on:z,self:r})}catch(g){let b=g;f("console")&&ce(s?.name??r.tagName.toLowerCase(),b),_=()=>{}}n=g=>{let b=s?.name??r.tagName.toLowerCase();if(f("errorBoundary"))try{_({state:g,refs:u,slots:p,self:r,detail:s,makeComponent:(y,h)=>W(y,a,h?.detail)}),M(),P(r),G(b)}catch(y){let h=y,T={component:b,element:r,error:h,state:l,refs:u,slots:p,timestamp:Date.now(),rerender:()=>n(g),stack:h.stack??""};f("console")?ae(T):le(b,h),ie(T),fe(T),de(r)}else _({state:g,refs:u,slots:p,self:r,detail:s,makeComponent:(y,h)=>W(y,a,h?.detail)}),M()},me(r,{state:l,refs:u,slots:p,self:r,detail:s,rerender:()=>n(l)})}n(d),t=r};return o[N]=!0,o}export{L as VERSION,Oe as boreDOM,se as clearGlobals,et as inflictBoreDOM,f as isDebugEnabled,be as queryComponent,R as registerComponent,I as setDebugConfig,ve as webComponent};
