var k=async t=>{let e=new Map;for(let n=0;n<t.length;++n){let r=A(`script[src*="${t[n]}"]`)?.getAttribute("src"),i=null;if(r)try{let o=await import(r);for(let s of Object.keys(o)){i=o[s];break}e.set(t[n],i)}catch(o){console.error(`Unable to import "${r}"`,o)}}return e},H=()=>Array.from(F("template[data-component]")).filter(t=>t instanceof HTMLElement).map(t=>{let e={name:"",attributes:[]};for(let n in t.dataset)n==="component"?e.name=t.dataset[n]??"":e.attributes.push([V(n),t.dataset[n]??""]);if(e.name==="")throw new Error(`A <template> was found with an invalid data-component: "${t.dataset.component}"`);return e}).map(({name:t,attributes:e})=>(_(t,{attributes:e}),t)),w=(t,e)=>{let n=f(t);if(!g(n)){let r=`The tag name "${t}" is not a BoreDOM  component.
      
"createComponent" only accepts tag-names with matching <template> tags that have a data-component attribute in them.`;throw console.error(r),new Error(r)}return e&&(n.renderCallback=e),n},D=t=>{let e=A(t);if(!(e===null||!g(e)))return e},A=t=>document.querySelector(t),F=t=>document.querySelectorAll(t),f=(t,e)=>{let n=document.createElement(t);return e&&Array.isArray(e)&&e.length>0&&e.map(r=>n.appendChild(r)),n};var z=(t,e)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(t,{detail:e}))):dispatchEvent(new CustomEvent(t,{detail:e}))};var O=t=>typeof t=="object",M=t=>typeof t=="function",g=t=>O(t)&&"isBored"in t&&!!t.isBored;var V=t=>{if(t===""||!t.split("").some(n=>n!==n.toLowerCase()))return t;let e="";for(let n=0;n<t.length;n++){let r=t[n];r===r.toUpperCase()&&n!==0&&(e+="-"),e+=r.toLowerCase()}return e};var E=t=>t.startsWith("on"),Q=t=>t.startsWith("queriedOn"),S=t=>E(t)?t.slice(2).toLowerCase():t.slice(9).toLowerCase(),C=class extends HTMLElement{},_=(t,e={})=>{customElements.get(t)||customElements.define(t,class extends C{static get observedAttributes(){return typeof e.attributeChangedCallback=="object"?Object.keys(e.attributeChangedCallback):[]}constructor(){super()}isBored=!0;traverse(n,{traverseShadowRoot:r,query:i}={}){Array.from(r?this.shadowRoot?.querySelectorAll(i??"*")??[]:[]).concat(Array.from(this.querySelectorAll(i??"*"))).filter(o=>o instanceof HTMLElement).forEach(n)}#t(n){return n.split("'").filter(r=>r.length>2&&!(r.includes("(")||r.includes(",")||r.includes(")")))}#e(){let n;this.traverse(r=>{if(r instanceof HTMLElement){customElements.get(r.tagName.toLowerCase())&&(n=r);for(let o=0;o<r.attributes.length;o++){let s=r.attributes[o];if(E(s.name)){let a=this.#t(s.value);a.length>0&&a.forEach(c=>{r.addEventListener(S(s.name),l=>z(c,{event:l,dispatcher:r,component:this,index:this.parentElement?Array.from(this.parentElement.children).indexOf(this):-1}))}),r.setAttribute(`data-${s.name}-dispatches`,a.join()),r.removeAttribute(s.name)}}}},{traverseShadowRoot:!0})}isInitialized=!1;#n(){let n=A(`[data-component="${t}"]`)??f("template"),r=n.getAttribute("shadowrootmode");if(e.style||e.shadow||r){let o=e.shadowrootmode??r??"open",s=this.attachShadow({mode:o});if(e.style){let a=f("style");a.textContent=e.style,s.appendChild(a)}if(e.shadow){let a=f("template");a.innerHTML=e.shadow,s.appendChild(a.content.cloneNode(!0))}else r&&s.appendChild(n.content.cloneNode(!0))}n&&!r&&this.appendChild(n.content.cloneNode(!0)),e.onSlotChange&&this.traverse(o=>{o instanceof HTMLSlotElement&&o.addEventListener("slotchange",s=>e.onSlotChange?.(s))},{traverseShadowRoot:!0}),M(e.onClick)&&this.addEventListener("click",e.onClick);for(let[o,s]of Object.entries(e))if(E(o)){if(!M(s))continue;this.addEventListener(S(o),s)}else if(Q(o)){let a=s;if(!O(a))continue;let c=S(o);for(let[l,d]of Object.entries(a))this.traverse(u=>{u.addEventListener(c,d)},{traverseShadowRoot:!0,query:l})}e.attributes&&Array.isArray(e.attributes)&&e.attributes.map(([o,s])=>this.setAttribute(o,s)),this.#e(),this.isInitialized=!0}renderCallback=n=>{};connectedCallback(){this.isInitialized||this.#n(),this.renderCallback(this),e.connectedCallback?.(this)}slots=b(this);updateSlot(n,r,i){document.createElement(i).setAttribute("slot",n)}disconnectedCallback(){e.disconnectedCallback?.(this)}adoptedCallback(){e.adoptedCallback?.(this)}attributeChangedCallback(n,r,i){e.attributeChangedCallback&&e.attributeChangedCallback[n]({element:this,name:n,oldValue:r,newValue:i})}})};function R(t,e){let n=e;return e===null||t.forEach(r=>{n=n[r]}),n}function $(t,e=[]){let n=[{path:[],obj:t}],r=[];for(;n.length>0;){let{path:i,obj:o}=n.pop();for(let s in o){if(e.includes(s))continue;let a=o[s],c=i.concat(s);typeof a=="object"&&a!==null&&n.push({path:c,obj:a}),r.push({path:c,value:a})}}return r}function v(t){if(t==null||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e==null?!0:e===Object.prototype}function W(t,e,n){return(r,i)=>{addEventListener(r,o=>{let s=o?.detail?.event.currentTarget,a;for(;s;){if(s===t){try{let c=i({state:e,e:o.detail,detail:n});Promise.resolve(c).catch(l=>{console.error(`Error in async handler for "${r}" event`,l)})}catch(c){console.error(`Error in handler for "${r}" event`,c)}return}s instanceof HTMLElement?s=s.parentElement:s=void 0}})}}function j(t){return new Proxy({},{get(e,n,r){let i=new Error(`Ref "${String(n)}" not found in <${t.tagName}>`);if(typeof n=="string"){let o=t.querySelectorAll(`[data-ref="${n}"]`);if(!o)throw i;let s=Array.from(o).filter(a=>a instanceof HTMLElement);if(s.length===0)throw i;return s.length===1?s[0]:s}}})}function b(t){return new Proxy({},{get(e,n,r){let i=new Error(`Slot "${String(n)}" not found in <${t.tagName}>`);if(typeof n=="string"){let o=t.querySelectorAll(`slot[name="${n}"]`);if(!o)throw i;let s=Array.from(o).filter(a=>a instanceof HTMLSlotElement);if(s.length===0)throw i;return s.length===1?s[0]:s}},set(e,n,r){if(typeof n!="string")return!1;let i=r;if(r instanceof HTMLElement)r.setAttribute("data-slot",n);else if(typeof r=="string")i=f("span"),i.setAttribute("data-slot",n),i.innerText=r;else throw new Error(`Invalid value for slot ${n} in <${t.tagName}>`);let o=Array.from(t.querySelectorAll(`[data-slot="${n}"]`));return o.length>0?o.forEach(s=>s.parentElement?.replaceChild(i,s)):Array.from(t.querySelectorAll(`slot[name="${n}"]`)).forEach(a=>a.parentElement?.replaceChild(i,a)),!0}})}function x(t,e,n){let r=n||{targets:new WeakMap,path:[]};if(t!==void 0)return new Proxy(t,{set(i,o,s){return typeof o=="string"&&console.error(`State is read-only for web components. Unable to set '${o}'.`),!1},get(i,o,s){let a=Reflect.get(i,o,s),c=o==="__proto__";if(typeof o=="string"&&!c&&(r.targets.has(i)||(r.targets.set(i,r.path.join(".")),r.path.push(o))),c||Array.isArray(a)||v(a))return x(a,e,r);let l=r.targets.get(i)??"";return typeof l=="string"&&typeof o=="string"&&(Array.isArray(i)||(l+=l!==""?`.${o}`:o),e.indexOf(l)===-1&&e.push(l)),r.path.length=0,r.path.push(l),a}})}function U(t){return()=>{let e=t.internal.updates;for(let n=0;n<e.path.length;n++){let r=e.path[n],i=r.slice(r.indexOf(".")+1),o=new Set,s=a=>{if(a)for(let c=0;c<a.length;c++){let l=a[c];o.has(l)||(o.add(l),l(t.app))}};s(e.subscribers.get(i));for(let[a,c]of e.subscribers.entries()){if(a===i)continue;let l=`${a}.`,d=`${i}.`;(i.startsWith(l)||a.startsWith(d))&&s(c)}}e.path=[],e.value=[],e.raf=void 0}}function P(t){let e=t.internal,n=t;if(n===void 0)return t;let r=new WeakSet;return $(t,["internal"]).forEach(({path:i,value:o})=>{if(Array.isArray(o)||v(o)&&!r.has(o)){let a=i.join("."),c=R(i.slice(0,-1),n);if(c===o)return;c[i.at(-1)]=new Proxy(o,{set(d,u,h){return!(d[u]!==h)||(Reflect.set(d,u,h),typeof u!="string")||(Array.isArray(o)?e.updates.path.push(`${a}`):e.updates.path.push(`${a}.${u}`),e.updates.value.push(d),e.updates.raf||(e.updates.raf=requestAnimationFrame(U(t)))),!0}}),r.add(o)}}),t}function B(t){let e=t.internal.customTags.filter(r=>document.querySelector(r)!==null),n=t.internal.components;for(let[r,i]of n.entries()){if(i===null||!e.includes(r))continue;let o=Array.from(document.querySelectorAll(r)).filter(s=>g(s));o.length!==0&&o.forEach((s,a)=>{i(t,{index:a,name:r,data:void 0})(s)})}}function q(t,e,n){let r=e.internal.components.get(t);if(r){let i={...n,tagName:t};return w(t,r(e,i))}return w(t)}var L="0.25.24";var N=!1;async function mt(t,e){N||(N=!0,typeof console<"u"&&typeof console.info=="function"&&console.info(`[boreDOM] v${L}`));let n=H(),r=await k(n);if(e)for(let s of Object.keys(e))r.set(s,e[s]);let o=P({app:t,internal:{customTags:n,components:r,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return B(o),o.app}function ht(t){let e=null,n;return(r,i)=>o=>{let{internal:s,app:a}=r,c=[],l=x(a,c),d=j(o),u=b(o),h=W(o,a,i);if(e!==o){let T=async()=>{let p=s.updates.subscribers;for(let y of c){let m=p.get(y);m?m.includes(n)||m.push(n):p.set(y,[n])}},I=t({detail:i,state:l,refs:d,on:h,self:o});n=p=>{I({state:p,refs:d,slots:u,self:o,detail:i,makeComponent:(y,m)=>q(y,r,m?.detail)}),T()}}n(l),e=o}}export{L as VERSION,mt as inflictBoreDOM,D as queryComponent,ht as webComponent};
