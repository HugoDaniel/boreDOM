var N=async e=>{let t=new Map;for(let r=0;r<e.length;++r){let s=Array.from(F("script[src]")).find(o=>((o.getAttribute("src")??"").split("/").pop()??"")===`${e[r]}.js`)?.getAttribute("src"),i=null;if(s)try{let l=await import(new URL(s,document.baseURI).href);for(let c of Object.keys(l)){i=l[c];break}t.set(e[r],i)}catch(o){console.error(`Unable to import "${s}"`,o)}}return t},q=()=>Array.from(F("template[data-component]")).filter(e=>e instanceof HTMLElement).map(e=>{let t={name:"",attributes:[]};for(let r in e.dataset)r==="component"?t.name=e.dataset[r]??"":t.attributes.push([ae(r),e.dataset[r]??""]);if(t.name==="")throw new Error(`A <template> was found with an invalid data-component: "${e.dataset.component}"`);return t}).map(({name:e,attributes:t})=>(ce(e,{attributes:t}),e)),H=(e,t)=>{let r=x(e);if(!M(r)){let n=`The tag name "${e}" is not a BoreDOM  component.
      
"createComponent" only accepts tag-names with matching <template> tags that have a data-component attribute in them.`;throw console.error(n),new Error(n)}return t&&(r.renderCallback=t),r},se=e=>{let t=_(e);if(!(t===null||!M(t)))return t},_=e=>document.querySelector(e),F=e=>document.querySelectorAll(e),x=(e,t)=>{let r=document.createElement(e);return t&&Array.isArray(t)&&t.length>0&&t.map(n=>r.appendChild(n)),r};var ie=(e,t)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(e,{detail:t}))):dispatchEvent(new CustomEvent(e,{detail:t}))};var U=e=>typeof e=="object",P=e=>typeof e=="function",M=e=>U(e)&&"isBored"in e&&!!e.isBored;var ae=e=>{if(e===""||!e.split("").some(r=>r!==r.toLowerCase()))return e;let t="";for(let r=0;r<e.length;r++){let n=e[r];n===n.toUpperCase()&&r!==0&&(t+="-"),t+=n.toLowerCase()}return t};var k=e=>e.startsWith("on"),le=e=>e.startsWith("queriedOn"),$=e=>k(e)?e.slice(2).toLowerCase():e.slice(9).toLowerCase(),D=class extends HTMLElement{},ce=(e,t={})=>{customElements.get(e)||customElements.define(e,class extends D{static get observedAttributes(){return typeof t.attributeChangedCallback=="object"?Object.keys(t.attributeChangedCallback):[]}constructor(){super()}isBored=!0;traverse(r,{traverseShadowRoot:n,query:a}={}){Array.from(n?this.shadowRoot?.querySelectorAll(a??"*")??[]:[]).concat(Array.from(this.querySelectorAll(a??"*"))).filter(s=>s instanceof HTMLElement).forEach(r)}#e(r){return r.split("'").filter(n=>n.length>2&&!(n.includes("(")||n.includes(",")||n.includes(")")))}#t(){let r;this.traverse(n=>{if(n instanceof HTMLElement){customElements.get(n.tagName.toLowerCase())&&(r=n);for(let s=0;s<n.attributes.length;s++){let i=n.attributes[s];if(k(i.name)){let o=this.#e(i.value);o.length>0&&o.forEach(l=>{n.addEventListener($(i.name),c=>ie(l,{event:c,dispatcher:n,component:this,index:this.parentElement?Array.from(this.parentElement.children).indexOf(this):-1}))}),n.setAttribute(`data-${i.name}-dispatches`,o.join()),n.removeAttribute(i.name)}}}},{traverseShadowRoot:!0})}isInitialized=!1;#r(){let r=_(`[data-component="${e}"]`)??x("template"),n=r.getAttribute("shadowrootmode");if(t.style||t.shadow||n){let s=t.shadowrootmode??n??"open",i=this.attachShadow({mode:s});if(t.style){let o=x("style");o.textContent=t.style,i.appendChild(o)}if(t.shadow){let o=x("template");o.innerHTML=t.shadow,i.appendChild(o.content.cloneNode(!0))}else n&&i.appendChild(r.content.cloneNode(!0))}r&&!n&&this.appendChild(r.content.cloneNode(!0)),t.onSlotChange&&this.traverse(s=>{s instanceof HTMLSlotElement&&s.addEventListener("slotchange",i=>t.onSlotChange?.(i))},{traverseShadowRoot:!0}),P(t.onClick)&&this.addEventListener("click",t.onClick);for(let[s,i]of Object.entries(t))if(k(s)){if(!P(i))continue;this.addEventListener($(s),i)}else if(le(s)){let o=i;if(!U(o))continue;let l=$(s);for(let[c,f]of Object.entries(o))this.traverse(d=>{d.addEventListener(l,f)},{traverseShadowRoot:!0,query:c})}t.attributes&&Array.isArray(t.attributes)&&t.attributes.map(([s,i])=>this.setAttribute(s,i)),this.#t(),this.isInitialized=!0}renderCallback=r=>{};connectedCallback(){this.isInitialized||this.#r(),this.renderCallback(this),t.connectedCallback?.(this)}slots=v(this);updateSlot(r,n,a){document.createElement(a).setAttribute("slot",r)}disconnectedCallback(){t.disconnectedCallback?.(this)}adoptedCallback(){t.adoptedCallback?.(this)}attributeChangedCallback(r,n,a){t.attributeChangedCallback&&t.attributeChangedCallback[r]({element:this,name:r,oldValue:n,newValue:a})}})};function z(e,t){let r=t;return t===null||e.forEach(n=>{r=r[n]}),r}function G(e,t=[]){let r=[{path:[],obj:e}],n=[];for(;r.length>0;){let{path:a,obj:s}=r.pop();for(let i in s){if(t.includes(i))continue;let o=s[i],l=a.concat(i);typeof o=="object"&&o!==null&&r.push({path:l,obj:o}),n.push({path:l,value:o})}}return n}function E(e){if(e==null||typeof e!="object")return!1;let t=Object.getPrototypeOf(e);return t==null?!0:t===Object.prototype}function Q(e,t,r){return(n,a)=>{addEventListener(n,s=>{let i=s?.detail?.event.currentTarget,o;for(;i;){if(i===e){try{let l=a({state:t,e:s.detail,detail:r});Promise.resolve(l).catch(c=>{console.error(`Error in async handler for "${n}" event`,c)})}catch(l){console.error(`Error in handler for "${n}" event`,l)}return}i instanceof HTMLElement?i=i.parentElement:i=void 0}})}}function J(e){return new Proxy({},{get(t,r,n){let a=new Error(`Ref "${String(r)}" not found in <${e.tagName}>`);if(typeof r=="string"){let s=e.querySelectorAll(`[data-ref="${r}"]`);if(!s)throw a;let i=Array.from(s).filter(o=>o instanceof HTMLElement);if(i.length===0)throw a;return i.length===1?i[0]:i}}})}function v(e){return new Proxy({},{get(t,r,n){let a=new Error(`Slot "${String(r)}" not found in <${e.tagName}>`);if(typeof r=="string"){let s=e.querySelectorAll(`slot[name="${r}"]`);if(!s)throw a;let i=Array.from(s).filter(o=>o instanceof HTMLSlotElement);if(i.length===0)throw a;return i.length===1?i[0]:i}},set(t,r,n){if(typeof r!="string")return!1;let a=n;if(n instanceof HTMLElement)n.setAttribute("data-slot",r);else if(typeof n=="string")a=x("span"),a.setAttribute("data-slot",r),a.innerText=n;else throw new Error(`Invalid value for slot ${r} in <${e.tagName}>`);let s=Array.from(e.querySelectorAll(`[data-slot="${r}"]`));return s.length>0?s.forEach(i=>i.parentElement?.replaceChild(a,i)):Array.from(e.querySelectorAll(`slot[name="${r}"]`)).forEach(o=>o.parentElement?.replaceChild(a,o)),!0}})}function R(e,t,r){let n=r||{targets:new WeakMap,path:[]};if(e!==void 0)return new Proxy(e,{set(a,s,i){return typeof s=="string"&&console.error(`State is read-only for web components. Unable to set '${s}'.`),!1},get(a,s,i){let o=Reflect.get(a,s,i),l=s==="__proto__";if(typeof s=="string"&&!l&&(n.targets.has(a)||(n.targets.set(a,n.path.join(".")),n.path.push(s))),l||Array.isArray(o)||E(o))return R(o,t,n);let c=n.targets.get(a)??"";return typeof c=="string"&&typeof s=="string"&&(Array.isArray(a)||(c+=c!==""?`.${s}`:s),t.indexOf(c)===-1&&t.push(c)),n.path.length=0,n.path.push(c),o}})}function fe(e){return()=>{let t=e.internal.updates,r=new Set,n=a=>{if(a)for(let s=0;s<a.length;s++){let i=a[s];if(!r.has(i)){r.add(i);try{i(e.app)}catch{}}}};for(let a=0;a<t.path.length;a++){let s=t.path[a],i=s.slice(s.indexOf(".")+1);n(t.subscribers.get(i));for(let[o,l]of t.subscribers.entries()){if(o===i)continue;let c=`${o}.`,f=`${i}.`;(i.startsWith(c)||o.startsWith(f))&&n(l)}}t.path=[],t.value=[],t.raf=void 0}}function K(e){let t=e.internal,r=e;if(r===void 0)return e;let n=new WeakSet,a=Symbol("boredom-proxy");function s(o,l){if(n.has(o))return o;let c=new Proxy(o,{get(f,d,u){return d===a?!0:Reflect.get(f,d,u)},set(f,d,u){if(!(f[d]!==u))return!0;if(typeof d=="string"){let w=Array.isArray(o)?l:`${l}.${d}`;!(u&&u[a]===!0)&&(Array.isArray(u)||E(u))&&(u=i(u,w))}return Reflect.set(f,d,u),typeof d!="string"||(Array.isArray(o)?t.updates.path.push(`${l}`):t.updates.path.push(`${l}.${d}`),t.updates.value.push(f),t.updates.raf||(t.updates.raf=requestAnimationFrame(fe(e)))),!0}});return n.add(o),n.add(c),c}function i(o,l){if(!Array.isArray(o)&&!E(o)||n.has(o)||o&&o[a]===!0)return o;if(Array.isArray(o))for(let c=0;c<o.length;c++){let f=o[c];(Array.isArray(f)||E(f))&&(o[c]=i(f,l))}else for(let c of Object.keys(o)){let f=o[c];(Array.isArray(f)||E(f))&&(o[c]=i(f,`${l}.${c}`))}return s(o,l)}return G(e,["internal"]).forEach(({path:o,value:l})=>{if(Array.isArray(l)||E(l)&&!n.has(l)){let f=o.join("."),d=z(o.slice(0,-1),r);if(d===l)return;d[o.at(-1)]=s(l,f)}}),e}function V(e){let t=e.internal.customTags.filter(n=>document.querySelector(n)!==null),r=e.internal.components;for(let[n,a]of r.entries()){if(a===null||!t.includes(n))continue;let s=Array.from(document.querySelectorAll(n)).filter(i=>M(i));s.length!==0&&s.forEach((i,o)=>{a(e,{index:o,name:n,data:void 0})(i)})}}function B(e,t,r){let n=t.internal.components.get(e);if(n){let a={...r,tagName:e};return H(e,n(t,a))}return H(e)}var A={console:!0,globals:!0,errorBoundary:!0,visualIndicators:!0,errorHistory:!0,versionLog:!0},S=new Map,p=null;function m(e){return typeof __DEBUG__<"u"&&!__DEBUG__?e==="errorBoundary"?A.errorBoundary??!0:!1:A[e]??!0}function j(e){if(typeof e=="boolean"){let t=e;A={console:t,globals:t,errorBoundary:!0,visualIndicators:t,errorHistory:t,versionLog:t}}else A={...A,...e}}function de(){return{...A}}function X(e){if(!m("globals")||typeof window>"u")return;let t=window;t.$state=e.state,t.$refs=e.refs,t.$slots=e.slots,t.$self=e.element,t.$error=e.error,t.$component=e.component,t.$rerender=e.rerender}function Y(){if(!m("globals")||typeof window>"u")return;let e=window;delete e.$state,delete e.$refs,delete e.$slots,delete e.$self,delete e.$error,delete e.$component,delete e.$rerender}function Z(e){m("console")&&(console.log("%c\u{1F534} boreDOM: Error in %c<%s>%c render","color: #ff6b6b; font-weight: bold","color: #4ecdc4; font-weight: bold",e.component,"color: #ff6b6b"),console.error(e.error),m("globals")&&(console.log("%c\u{1F4CB} Debug context loaded:","color: #95a5a6; font-weight: bold"),console.log("   $state     \u2192",e.state),console.log("   $refs      \u2192",e.refs),console.log("   $slots     \u2192",e.slots),console.log("   $self      \u2192",e.element),console.log("%c\u{1F4A1} Quick fixes:","color: #f39c12; font-weight: bold"),console.log("   $state.propertyName = value"),console.log("   $rerender()"),console.log("%c\u{1F4E4} When fixed:","color: #27ae60; font-weight: bold"),console.log(`   boreDOM.export('${e.component}')`)))}function ee(e,t){console.error(`[boreDOM] Render error in <${e}>: ${t.message}`)}function te(e,t){m("console")&&(console.log("%c\u{1F534} boreDOM: Error in %c<%s>%c init","color: #ff6b6b; font-weight: bold","color: #4ecdc4; font-weight: bold",e,"color: #ff6b6b"),console.error(t))}function re(e){m("errorHistory")&&(S.set(e.component,e),p=e)}function W(e){e?(S.delete(e),p?.component===e&&(p=null)):p&&(S.delete(p.component),p=null)}function ne(e){m("visualIndicators")&&e.setAttribute("data-boredom-error","true")}function I(e){e.removeAttribute("data-boredom-error")}function ue(e){let t=e?S.get(e):p;if(!t)return null;try{return{component:t.component,state:JSON.parse(JSON.stringify(t.state)),timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}catch{return{component:t.component,state:"[Unable to serialize - contains circular references or functions]",timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}}var C={get errors(){return S},get lastError(){return p},rerender(e){let t=e?S.get(e):p;t?t.rerender():console.warn("[boreDOM] No error context found to rerender")},clearError(e){let t=e?S.get(e):p;t&&(I(t.element),W(e),Y())},export:ue,get config(){return de()}};var L="0.25.25";var oe=!1,me={get errors(){return C.errors},get lastError(){return C.lastError},rerender:C.rerender,clearError:C.clearError,export:C.export,get config(){return C.config},version:L};typeof window<"u"&&(window.boreDOM=me);async function Be(e,t,r){r?.debug!==void 0&&j(r.debug),!oe&&m("versionLog")&&(oe=!0,typeof console<"u"&&typeof console.info=="function"&&console.info(`[boreDOM] v${L}`));let n=q(),a=await N(n);if(t)for(let o of Object.keys(t))a.set(o,t[o]);let i=K({app:e,internal:{customTags:n,components:a,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return i.internal.updates.path=[],i.internal.updates.value=[],i.internal.updates.raf&&(cancelAnimationFrame(i.internal.updates.raf),i.internal.updates.raf=void 0),V(i),i.app}function je(e){let t=null,r;return(n,a)=>s=>{let{internal:i,app:o}=n,l=[],c=R(o,l),f=J(s),d=v(s),u=Q(s,o,a);if(t!==s){let O=async()=>{let g=i.updates.subscribers;for(let y of l){let h=g.get(y);h?h.includes(r)||h.push(r):g.set(y,[r])}},w;try{w=e({detail:a,state:c,refs:f,on:u,self:s})}catch(g){let y=g;m("console")&&te(a?.name??s.tagName.toLowerCase(),y),w=()=>{}}r=g=>{let y=a?.name??s.tagName.toLowerCase();if(m("errorBoundary"))try{w({state:g,refs:f,slots:d,self:s,detail:a,makeComponent:(h,b)=>B(h,n,b?.detail)}),O(),I(s),W(y)}catch(h){let b=h,T={component:y,element:s,error:b,state:o,refs:f,slots:d,timestamp:Date.now(),rerender:()=>r(g),stack:b.stack??""};m("console")?Z(T):ee(y,b),X(T),re(T),ne(s)}else w({state:g,refs:f,slots:d,self:s,detail:a,makeComponent:(h,b)=>B(h,n,b?.detail)}),O()}}r(c),t=s}}export{L as VERSION,me as boreDOM,Y as clearGlobals,Be as inflictBoreDOM,m as isDebugEnabled,se as queryComponent,j as setDebugConfig,je as webComponent};
