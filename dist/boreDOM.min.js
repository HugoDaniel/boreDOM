var T=async t=>{let e=new Map;for(let n=0;n<t.length;++n){let r=S(`script[src*="${t[n]}"]`)?.getAttribute("src"),s=null;if(r)try{let o=await import(r);for(let a of Object.keys(o)){s=o[a];break}e.set(t[n],s)}catch(o){console.error(`Unable to import "${r}"`,o)}}return e},x=()=>Array.from(W("template[data-component]")).filter(t=>t instanceof HTMLElement).map(t=>{let e={name:"",attributes:[]};for(let n in t.dataset)n==="component"?e.name=t.dataset[n]??"":e.attributes.push([P(n),t.dataset[n]??""]);if(e.name==="")throw new Error(`A <template> was found with an invalid data-component: "${t.dataset.component}"`);return e}).map(({name:t,attributes:e})=>(F(t,{attributes:e}),t));var A=t=>{let e=S(t);if(e instanceof p)return e},S=t=>document.querySelector(t),W=t=>document.querySelectorAll(t),f=(t,e)=>{let n=document.createElement(t);return e&&Array.isArray(e)&&e.length>0&&e.map(r=>n.appendChild(r)),n};var q=(t,e)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(t,{detail:e}))):dispatchEvent(new CustomEvent(t,{detail:e}))};var N=t=>typeof t=="object",v=t=>typeof t=="function";var P=t=>{if(t===""||!t.split("").some(n=>n!==n.toLowerCase()))return t;let e="";for(let n=0;n<t.length;n++){let r=t[n];r===r.toUpperCase()&&n!==0&&(e+="-"),e+=r.toLowerCase()}return e};var b=t=>t.startsWith("on"),B=t=>t.startsWith("queriedOn"),y=t=>b(t)?t.slice(2).toLowerCase():t.slice(9).toLowerCase(),p=class extends HTMLElement{},F=(t,e={})=>{customElements.get(t)||customElements.define(t,class extends p{static get observedAttributes(){return typeof e.attributeChangedCallback=="object"?Object.keys(e.attributeChangedCallback):[]}constructor(){super()}traverse(n,{traverseShadowRoot:r,query:s}={}){Array.from(r?this.shadowRoot?.querySelectorAll(s??"*")??[]:[]).concat(Array.from(this.querySelectorAll(s??"*"))).filter(o=>o instanceof HTMLElement).forEach(n)}#e(n){return n.split("'").filter(r=>r.length>2&&!(r.includes("(")||r.includes(",")||r.includes(")")))}#n(){let n;this.traverse(r=>{if(r instanceof HTMLElement){customElements.get(r.tagName.toLowerCase())&&(n=r);for(let o=0;o<r.attributes.length;o++){let a=r.attributes[o];if(b(a.name)){let i=this.#e(a.value);i.length>0&&i.forEach(c=>{r.addEventListener(y(a.name),l=>q(c,{event:l}))}),r.setAttribute(`data-${a.name}-dispatches`,i.join()),r.removeAttribute(a.name)}}}},{traverseShadowRoot:!0})}#t=!1;#r(){let n=S(`[data-component="${t}"]`)??f("template"),r=n.getAttribute("shadowrootmode");if(e.style||e.shadow||r){let o=e.shadowrootmode??r??"open",a=this.attachShadow({mode:o});if(e.style){let i=f("style");i.textContent=e.style,a.appendChild(i)}if(e.shadow){let i=f("template");i.innerHTML=e.shadow,a.appendChild(i.content.cloneNode(!0))}else r&&a.appendChild(n.content.cloneNode(!0))}n&&!r&&this.appendChild(n.content.cloneNode(!0)),e.onSlotChange&&this.traverse(o=>{o instanceof HTMLSlotElement&&o.addEventListener("slotchange",a=>e.onSlotChange?.(a))},{traverseShadowRoot:!0}),v(e.onClick)&&this.addEventListener("click",e.onClick);for(let[o,a]of Object.entries(e))if(b(o)){if(!v(a))continue;this.addEventListener(y(o),a)}else if(B(o)){let i=a;if(!N(i))continue;let c=y(o);for(let[l,u]of Object.entries(i))this.traverse(d=>{d.addEventListener(c,u)},{traverseShadowRoot:!0,query:l})}e.attributes&&Array.isArray(e.attributes)&&e.attributes.map(([o,a])=>this.setAttribute(o,a)),this.#n(),this.#t=!0}renderCallback=n=>{};connectedCallback(){this.#t||this.#r(),this.renderCallback(this),e.connectedCallback?.(this)}updateSlot(n,r,s){document.createElement(s).setAttribute("slot",n)}disconnectedCallback(){console.log("disconnected "+this.tagName),e.disconnectedCallback?.(this)}adoptedCallback(){e.adoptedCallback?.(this)}attributeChangedCallback(n,r,s){e.attributeChangedCallback&&e.attributeChangedCallback[n]({element:this,name:n,oldValue:r,newValue:s})}})};function M(t,e){let n=e;return e===null||t.forEach(r=>{n=n[r]}),n}function k(t,e=[]){let n=[{path:[],obj:t}],r=[];for(;n.length>0;){let{path:s,obj:o}=n.pop();for(let a in o){if(e.includes(a))continue;let i=o[a],c=s.concat(a);typeof i=="object"&&i!==null&&n.push({path:c,obj:i}),r.push({path:c,value:i})}}return r}function E(t){if(t==null||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e==null?!0:e===Object.prototype}function H(t,e){return(n,r)=>{addEventListener(n,s=>{let o=s?.detail?.event.currentTarget;for(;o;){if(o===t){r(e,s.detail);return}o instanceof HTMLElement?o=o.parentElement:o=void 0}})}}function O(t){return new Proxy({},{get(e,n,r){let s=new Error(`Ref "${String(n)}" not found in <${t.tagName}>`);if(typeof n=="string"){let o=t.querySelectorAll(`[data-ref="${n}"]`);if(!o)throw s;let a=Array.from(o).filter(i=>i instanceof HTMLElement);if(a.length===0)throw s;return a.length===1?a[0]:a}}})}function j(t){return new Proxy({},{get(e,n,r){let s=new Error(`Slot "${String(n)}" not found in <${t.tagName}>`);if(typeof n=="string"){let o=t.querySelectorAll(`slot[name="${n}"]`);if(!o)throw s;let a=Array.from(o).filter(i=>i instanceof HTMLSlotElement);if(a.length===0)throw s;return a.length===1?a[0]:a}},set(e,n,r){if(typeof n!="string")return!1;let s=r;if(r instanceof HTMLElement)r.setAttribute("data-slot",n);else if(typeof r=="string")s=f("span"),s.setAttribute("data-slot",n),s.innerText=r;else throw new Error(`Invalid value for slot ${n} in <${t.tagName}>`);let o=Array.from(t.querySelectorAll(`[data-slot="${n}"]`));return o.length>0?o.forEach(a=>a.parentElement?.replaceChild(s,a)):Array.from(t.querySelectorAll(`slot[name="${n}"]`)).forEach(i=>i.parentElement?.replaceChild(s,i)),!0}})}function C(t,e,n){let r=n||{targets:new WeakMap,path:[]};if(t!==void 0)return new Proxy(t,{set(s,o,a){return typeof o=="string"&&console.error(`State is read-only for web components. Unable to set '${o}'.`),!1},get(s,o,a){let i=Reflect.get(s,o,a),c=o==="__proto__";if(typeof o=="string"&&!c&&(r.targets.has(s)||(r.targets.set(s,r.path.join(".")),r.path.push(o))),c||E(i))return C(i,e,r);let l=r.targets.get(s)??"";return typeof l=="string"&&typeof o=="string"&&(l+=l!==""?`.${o}`:o,e.indexOf(l)===-1&&e.push(l)),r.path.length=0,r.path.push(l),i}})}function I(t){return()=>{let e=t.internal.updates;for(let n=0;n<e.path.length;n++){let r=e.path[n],s=e.subscribers.get(r.slice(r.indexOf(".")+1))??[];for(let o=0;o<s.length;o++)s[o](t.app)}e.path=[],e.value=[],e.raf=void 0}}function R(t){let e=t.internal,n=t;if(n===void 0)return t;let r=new WeakSet;return k(t,["internal"]).forEach(({path:s,value:o})=>{if(E(o)&&!r.has(o)){let i=s.join("."),c=M(s.slice(0,-1),n);if(c===o)return;c[s.at(-1)]=new Proxy(o,{set(u,d,m){return!(u[d]!==m)||(Reflect.set(u,d,m),typeof d!="string")||(e.updates.path.push(`${i}.${d}`),e.updates.value.push(u),e.updates.raf||(e.updates.raf=requestAnimationFrame(I(t)))),!0}}),r.add(o)}}),t}function $(t){let e=t.internal.components;for(let[n,r]of e.entries()){if(r===null)continue;let s=A(n);if(!s){console.log(`<${n}> is not yet in the DOM. The associated JS script will be called when the component is connected.`);return}r(t)(s)}}async function ot(t){let e=x(),n=await T(e),s=R({app:t,internal:{customTags:e,components:n,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return $(s),s.app}function st(t){let e=null,n;return({internal:r,app:s},o)=>a=>{let i=[],c=C(s,i),l=O(a),u=j(a),d=H(a,s);if(e!==a){let m=async()=>{let h=r.updates.subscribers;for(let L of i){let g=h.get(L);g?g.includes(n)||g.push(n):h.set(L,[n])}},w=t({detail:o,state:c,refs:l,on:d});n=h=>{w({state:h,refs:l,slots:u,detail:o},a),m()}}n(c),e=a}}export{ot as inflictBoreDOM,st as webComponent};
