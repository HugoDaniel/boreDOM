var v=async t=>{let e=new Map;for(let n=0;n<t.length;++n){let o=Array.from(H("script[src]")).find(s=>((s.getAttribute("src")??"").split("/").pop()??"")===`${t[n]}.js`)?.getAttribute("src"),i=null;if(o)try{let c=await import(new URL(o,document.baseURI).href);for(let l of Object.keys(c)){i=c[l];break}e.set(t[n],i)}catch(s){console.error(`Unable to import "${o}"`,s)}}return e},R=()=>Array.from(H("template[data-component]")).filter(t=>t instanceof HTMLElement).map(t=>{let e={name:"",attributes:[]};for(let n in t.dataset)n==="component"?e.name=t.dataset[n]??"":e.attributes.push([U(n),t.dataset[n]??""]);if(e.name==="")throw new Error(`A <template> was found with an invalid data-component: "${t.dataset.component}"`);return e}).map(({name:t,attributes:e})=>(Q(t,{attributes:e}),t)),x=(t,e)=>{let n=p(t);if(!b(n)){let r=`The tag name "${t}" is not a BoreDOM  component.
      
"createComponent" only accepts tag-names with matching <template> tags that have a data-component attribute in them.`;throw console.error(r),new Error(r)}return e&&(n.renderCallback=e),n},F=t=>{let e=O(t);if(!(e===null||!b(e)))return e},O=t=>document.querySelector(t),H=t=>document.querySelectorAll(t),p=(t,e)=>{let n=document.createElement(t);return e&&Array.isArray(e)&&e.length>0&&e.map(r=>n.appendChild(r)),n};var z=(t,e)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(t,{detail:e}))):dispatchEvent(new CustomEvent(t,{detail:e}))};var $=t=>typeof t=="object",k=t=>typeof t=="function",b=t=>$(t)&&"isBored"in t&&!!t.isBored;var U=t=>{if(t===""||!t.split("").some(n=>n!==n.toLowerCase()))return t;let e="";for(let n=0;n<t.length;n++){let r=t[n];r===r.toUpperCase()&&n!==0&&(e+="-"),e+=r.toLowerCase()}return e};var A=t=>t.startsWith("on"),_=t=>t.startsWith("queriedOn"),C=t=>A(t)?t.slice(2).toLowerCase():t.slice(9).toLowerCase(),w=class extends HTMLElement{},Q=(t,e={})=>{customElements.get(t)||customElements.define(t,class extends w{static get observedAttributes(){return typeof e.attributeChangedCallback=="object"?Object.keys(e.attributeChangedCallback):[]}constructor(){super()}isBored=!0;traverse(n,{traverseShadowRoot:r,query:a}={}){Array.from(r?this.shadowRoot?.querySelectorAll(a??"*")??[]:[]).concat(Array.from(this.querySelectorAll(a??"*"))).filter(o=>o instanceof HTMLElement).forEach(n)}#t(n){return n.split("'").filter(r=>r.length>2&&!(r.includes("(")||r.includes(",")||r.includes(")")))}#e(){let n;this.traverse(r=>{if(r instanceof HTMLElement){customElements.get(r.tagName.toLowerCase())&&(n=r);for(let o=0;o<r.attributes.length;o++){let i=r.attributes[o];if(A(i.name)){let s=this.#t(i.value);s.length>0&&s.forEach(c=>{r.addEventListener(C(i.name),l=>z(c,{event:l,dispatcher:r,component:this,index:this.parentElement?Array.from(this.parentElement.children).indexOf(this):-1}))}),r.setAttribute(`data-${i.name}-dispatches`,s.join()),r.removeAttribute(i.name)}}}},{traverseShadowRoot:!0})}isInitialized=!1;#n(){let n=O(`[data-component="${t}"]`)??p("template"),r=n.getAttribute("shadowrootmode");if(e.style||e.shadow||r){let o=e.shadowrootmode??r??"open",i=this.attachShadow({mode:o});if(e.style){let s=p("style");s.textContent=e.style,i.appendChild(s)}if(e.shadow){let s=p("template");s.innerHTML=e.shadow,i.appendChild(s.content.cloneNode(!0))}else r&&i.appendChild(n.content.cloneNode(!0))}n&&!r&&this.appendChild(n.content.cloneNode(!0)),e.onSlotChange&&this.traverse(o=>{o instanceof HTMLSlotElement&&o.addEventListener("slotchange",i=>e.onSlotChange?.(i))},{traverseShadowRoot:!0}),k(e.onClick)&&this.addEventListener("click",e.onClick);for(let[o,i]of Object.entries(e))if(A(o)){if(!k(i))continue;this.addEventListener(C(o),i)}else if(_(o)){let s=i;if(!$(s))continue;let c=C(o);for(let[l,d]of Object.entries(s))this.traverse(f=>{f.addEventListener(c,d)},{traverseShadowRoot:!0,query:l})}e.attributes&&Array.isArray(e.attributes)&&e.attributes.map(([o,i])=>this.setAttribute(o,i)),this.#e(),this.isInitialized=!0}renderCallback=n=>{};connectedCallback(){this.isInitialized||this.#n(),this.renderCallback(this),e.connectedCallback?.(this)}slots=S(this);updateSlot(n,r,a){document.createElement(a).setAttribute("slot",n)}disconnectedCallback(){e.disconnectedCallback?.(this)}adoptedCallback(){e.adoptedCallback?.(this)}attributeChangedCallback(n,r,a){e.attributeChangedCallback&&e.attributeChangedCallback[n]({element:this,name:n,oldValue:r,newValue:a})}})};function j(t,e){let n=e;return e===null||t.forEach(r=>{n=n[r]}),n}function W(t,e=[]){let n=[{path:[],obj:t}],r=[];for(;n.length>0;){let{path:a,obj:o}=n.pop();for(let i in o){if(e.includes(i))continue;let s=o[i],c=a.concat(i);typeof s=="object"&&s!==null&&n.push({path:c,obj:s}),r.push({path:c,value:s})}}return r}function m(t){if(t==null||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e==null?!0:e===Object.prototype}function P(t,e,n){return(r,a)=>{addEventListener(r,o=>{let i=o?.detail?.event.currentTarget,s;for(;i;){if(i===t){try{let c=a({state:e,e:o.detail,detail:n});Promise.resolve(c).catch(l=>{console.error(`Error in async handler for "${r}" event`,l)})}catch(c){console.error(`Error in handler for "${r}" event`,c)}return}i instanceof HTMLElement?i=i.parentElement:i=void 0}})}}function B(t){return new Proxy({},{get(e,n,r){let a=new Error(`Ref "${String(n)}" not found in <${t.tagName}>`);if(typeof n=="string"){let o=t.querySelectorAll(`[data-ref="${n}"]`);if(!o)throw a;let i=Array.from(o).filter(s=>s instanceof HTMLElement);if(i.length===0)throw a;return i.length===1?i[0]:i}}})}function S(t){return new Proxy({},{get(e,n,r){let a=new Error(`Slot "${String(n)}" not found in <${t.tagName}>`);if(typeof n=="string"){let o=t.querySelectorAll(`slot[name="${n}"]`);if(!o)throw a;let i=Array.from(o).filter(s=>s instanceof HTMLSlotElement);if(i.length===0)throw a;return i.length===1?i[0]:i}},set(e,n,r){if(typeof n!="string")return!1;let a=r;if(r instanceof HTMLElement)r.setAttribute("data-slot",n);else if(typeof r=="string")a=p("span"),a.setAttribute("data-slot",n),a.innerText=r;else throw new Error(`Invalid value for slot ${n} in <${t.tagName}>`);let o=Array.from(t.querySelectorAll(`[data-slot="${n}"]`));return o.length>0?o.forEach(i=>i.parentElement?.replaceChild(a,i)):Array.from(t.querySelectorAll(`slot[name="${n}"]`)).forEach(s=>s.parentElement?.replaceChild(a,s)),!0}})}function L(t,e,n){let r=n||{targets:new WeakMap,path:[]};if(t!==void 0)return new Proxy(t,{set(a,o,i){return typeof o=="string"&&console.error(`State is read-only for web components. Unable to set '${o}'.`),!1},get(a,o,i){let s=Reflect.get(a,o,i),c=o==="__proto__";if(typeof o=="string"&&!c&&(r.targets.has(a)||(r.targets.set(a,r.path.join(".")),r.path.push(o))),c||Array.isArray(s)||m(s))return L(s,e,r);let l=r.targets.get(a)??"";return typeof l=="string"&&typeof o=="string"&&(Array.isArray(a)||(l+=l!==""?`.${o}`:o),e.indexOf(l)===-1&&e.push(l)),r.path.length=0,r.path.push(l),s}})}function J(t){return()=>{let e=t.internal.updates,n=new Set,r=a=>{if(a)for(let o=0;o<a.length;o++){let i=a[o];n.has(i)||(n.add(i),i(t.app))}};for(let a=0;a<e.path.length;a++){let o=e.path[a],i=o.slice(o.indexOf(".")+1);r(e.subscribers.get(i));for(let[s,c]of e.subscribers.entries()){if(s===i)continue;let l=`${s}.`,d=`${i}.`;(i.startsWith(l)||s.startsWith(d))&&r(c)}}e.path=[],e.value=[],e.raf=void 0}}function q(t){let e=t.internal,n=t;if(n===void 0)return t;let r=new WeakSet,a=Symbol("boredom-proxy");function o(s,c){if(r.has(s))return s;let l=new Proxy(s,{get(d,f,u){return f===a?!0:Reflect.get(d,f,u)},set(d,f,u){if(!(d[f]!==u))return!0;if(typeof f=="string"){let E=Array.isArray(s)?c:`${c}.${f}`;!(u&&u[a]===!0)&&(Array.isArray(u)||m(u))&&(u=i(u,E))}return Reflect.set(d,f,u),typeof f!="string"||(Array.isArray(s)?e.updates.path.push(`${c}`):e.updates.path.push(`${c}.${f}`),e.updates.value.push(d),e.updates.raf||(e.updates.raf=requestAnimationFrame(J(t)))),!0}});return r.add(s),r.add(l),l}function i(s,c){if(!Array.isArray(s)&&!m(s)||r.has(s)||s&&s[a]===!0)return s;if(Array.isArray(s))for(let l=0;l<s.length;l++){let d=s[l];(Array.isArray(d)||m(d))&&(s[l]=i(d,c))}else for(let l of Object.keys(s)){let d=s[l];(Array.isArray(d)||m(d))&&(s[l]=i(d,`${c}.${l}`))}return o(s,c)}return W(t,["internal"]).forEach(({path:s,value:c})=>{if(Array.isArray(c)||m(c)&&!r.has(c)){let d=s.join("."),f=j(s.slice(0,-1),n);if(f===c)return;f[s.at(-1)]=o(c,d)}}),t}function N(t){let e=t.internal.customTags.filter(r=>document.querySelector(r)!==null),n=t.internal.components;for(let[r,a]of n.entries()){if(a===null||!e.includes(r))continue;let o=Array.from(document.querySelectorAll(r)).filter(i=>b(i));o.length!==0&&o.forEach((i,s)=>{a(t,{index:s,name:r,data:void 0})(i)})}}function I(t,e,n){let r=e.internal.components.get(t);if(r){let a={...n,tagName:t};return x(t,r(e,a))}return x(t)}var T="0.25.25";var D=!1;async function mt(t,e){D||(D=!0,typeof console<"u"&&typeof console.info=="function"&&console.info(`[boreDOM] v${T}`));let n=R(),r=await v(n);if(e)for(let i of Object.keys(e))r.set(i,e[i]);let o=q({app:t,internal:{customTags:n,components:r,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return o.internal.updates.path=[],o.internal.updates.value=[],o.internal.updates.raf&&(cancelAnimationFrame(o.internal.updates.raf),o.internal.updates.raf=void 0),N(o),o.app}function pt(t){let e=null,n;return(r,a)=>o=>{let{internal:i,app:s}=r,c=[],l=L(s,c),d=B(o),f=S(o),u=P(o,s,a);if(e!==o){let M=async()=>{let h=i.updates.subscribers;for(let g of c){let y=h.get(g);y?y.includes(n)||y.push(n):h.set(g,[n])}},E=t({detail:a,state:l,refs:d,on:u,self:o});n=h=>{E({state:h,refs:d,slots:f,self:o,detail:a,makeComponent:(g,y)=>I(g,r,y?.detail)}),M()}}n(l),e=o}}export{T as VERSION,mt as inflictBoreDOM,F as queryComponent,pt as webComponent};
