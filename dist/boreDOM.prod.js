var J=async e=>{let t=new Map;for(let n=0;n<e.length;++n){let s=Array.from(V("script[src]")).find(i=>((i.getAttribute("src")??"").split("/").pop()??"")===`${e[n]}.js`)?.getAttribute("src"),o=null;if(s)try{let l=await import(new URL(s,document.baseURI).href);for(let c of Object.keys(l)){o=l[c];break}t.set(e[n],o)}catch(i){console.error(`Unable to import "${s}"`,i)}}return t},Q=()=>Array.from(V("template[data-component]")).filter(e=>e instanceof HTMLElement).map(e=>{let t={name:"",attributes:[]};for(let n in e.dataset)n==="component"?t.name=e.dataset[n]??"":t.attributes.push([fe(n),e.dataset[n]??""]);if(t.name==="")throw new Error(`A <template> was found with an invalid data-component: "${e.dataset.component}"`);return t}).map(({name:e,attributes:t})=>(Y(e,{attributes:t}),e)),H=(e,t)=>{let n=C(e);if(!D(n)){let r=`The tag name "${e}" is not a BoreDOM  component.
      
"createComponent" only accepts tag-names with matching <template> tags that have a data-component attribute in them.`;throw console.error(r),new Error(r)}return t&&(n.renderCallback=t),n},le=e=>{let t=K(e);if(!(t===null||!D(t)))return t},K=e=>document.querySelector(e),V=e=>document.querySelectorAll(e),C=(e,t)=>{let n=document.createElement(e);return t&&Array.isArray(t)&&t.length>0&&t.map(r=>n.appendChild(r)),n};var ce=(e,t)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(e,{detail:t}))):dispatchEvent(new CustomEvent(e,{detail:t}))};var X=e=>typeof e=="object",z=e=>typeof e=="function",D=e=>X(e)&&"isBored"in e&&!!e.isBored;var fe=e=>{if(e===""||!e.split("").some(n=>n!==n.toLowerCase()))return e;let t="";for(let n=0;n<e.length;n++){let r=e[n];r===r.toUpperCase()&&n!==0&&(t+="-"),t+=r.toLowerCase()}return t};var B=e=>e.startsWith("on"),de=e=>e.startsWith("queriedOn"),$=e=>B(e)?e.slice(2).toLowerCase():e.slice(9).toLowerCase(),k=class extends HTMLElement{},Y=(e,t={})=>{customElements.get(e)||customElements.define(e,class extends k{static get observedAttributes(){return typeof t.attributeChangedCallback=="object"?Object.keys(t.attributeChangedCallback):[]}constructor(){super()}isBored=!0;traverse(n,{traverseShadowRoot:r,query:a}={}){Array.from(r?this.shadowRoot?.querySelectorAll(a??"*")??[]:[]).concat(Array.from(this.querySelectorAll(a??"*"))).filter(s=>s instanceof HTMLElement).forEach(n)}#e(n){return n.split("'").filter(r=>r.length>2&&!(r.includes("(")||r.includes(",")||r.includes(")")))}#t(){let n;this.traverse(r=>{if(r instanceof HTMLElement){customElements.get(r.tagName.toLowerCase())&&(n=r);for(let s=0;s<r.attributes.length;s++){let o=r.attributes[s];if(B(o.name)){let i=this.#e(o.value);i.length>0&&i.forEach(l=>{r.addEventListener($(o.name),c=>ce(l,{event:c,dispatcher:r,component:this,index:this.parentElement?Array.from(this.parentElement.children).indexOf(this):-1}))}),r.setAttribute(`data-${o.name}-dispatches`,i.join()),r.removeAttribute(o.name)}}}},{traverseShadowRoot:!0})}isInitialized=!1;#n(){let n=K(`[data-component="${e}"]`)??C("template"),r=n.getAttribute("shadowrootmode");if(t.style||t.shadow||r){let s=t.shadowrootmode??r??"open",o=this.attachShadow({mode:s});if(t.style){let i=C("style");i.textContent=t.style,o.appendChild(i)}if(t.shadow){let i=C("template");i.innerHTML=t.shadow,o.appendChild(i.content.cloneNode(!0))}else r&&o.appendChild(n.content.cloneNode(!0))}n&&!r&&this.appendChild(n.content.cloneNode(!0)),t.onSlotChange&&this.traverse(s=>{s instanceof HTMLSlotElement&&s.addEventListener("slotchange",o=>t.onSlotChange?.(o))},{traverseShadowRoot:!0}),z(t.onClick)&&this.addEventListener("click",t.onClick);for(let[s,o]of Object.entries(t))if(B(s)){if(!z(o))continue;this.addEventListener($(s),o)}else if(de(s)){let i=o;if(!X(i))continue;let l=$(s);for(let[c,f]of Object.entries(i))this.traverse(d=>{d.addEventListener(l,f)},{traverseShadowRoot:!0,query:c})}t.attributes&&Array.isArray(t.attributes)&&t.attributes.map(([s,o])=>this.setAttribute(s,o)),this.#t(),this.isInitialized=!0}renderCallback=n=>{};connectedCallback(){this.isInitialized||this.#n(),this.renderCallback(this),t.connectedCallback?.(this)}slots=v(this);updateSlot(n,r,a){document.createElement(a).setAttribute("slot",n)}disconnectedCallback(){t.disconnectedCallback?.(this)}adoptedCallback(){t.adoptedCallback?.(this)}attributeChangedCallback(n,r,a){t.attributeChangedCallback&&t.attributeChangedCallback[n]({element:this,name:n,oldValue:r,newValue:a})}})},R=e=>{Y(e,{})};function Z(e,t){let n=t;return t===null||e.forEach(r=>{n=n[r]}),n}function ee(e,t=[]){let n=[{path:[],obj:e}],r=[],a=new WeakSet;for(;n.length>0;){let{path:s,obj:o}=n.pop();if(!a.has(o)){a.add(o);for(let i in o){if(t.includes(i))continue;let l=o[i],c=s.concat(i);typeof l=="object"&&l!==null&&!a.has(l)&&n.push({path:c,obj:l}),r.push({path:c,value:l})}}}return r}function E(e){if(e==null||typeof e!="object")return!1;let t=Object.getPrototypeOf(e);return t==null?!0:t===Object.prototype}function te(e,t,n){return(r,a)=>{addEventListener(r,s=>{let o=s?.detail?.event.currentTarget,i;for(;o;){if(o===e){try{let l=a({state:t,e:s.detail,detail:n});Promise.resolve(l).catch(c=>{console.error(`Error in async handler for "${r}" event`,c)})}catch(l){console.error(`Error in handler for "${r}" event`,l)}return}o instanceof HTMLElement?o=o.parentElement:o=void 0}})}}function ne(e){return new Proxy({},{get(t,n,r){let a=new Error(`Ref "${String(n)}" not found in <${e.tagName}>`);if(typeof n=="string"){let s=e.querySelectorAll(`[data-ref="${n}"]`);if(!s)throw a;let o=Array.from(s).filter(i=>i instanceof HTMLElement);if(o.length===0)throw a;return o.length===1?o[0]:o}}})}function v(e){return new Proxy({},{get(t,n,r){let a=new Error(`Slot "${String(n)}" not found in <${e.tagName}>`);if(typeof n=="string"){let s=e.querySelectorAll(`slot[name="${n}"]`);if(!s)throw a;let o=Array.from(s).filter(i=>i instanceof HTMLSlotElement);if(o.length===0)throw a;return o.length===1?o[0]:o}},set(t,n,r){if(typeof n!="string")return!1;let a=r;if(r instanceof HTMLElement)r.setAttribute("data-slot",n);else if(typeof r=="string")a=C("span"),a.setAttribute("data-slot",n),a.innerText=r;else throw new Error(`Invalid value for slot ${n} in <${e.tagName}>`);let s=Array.from(e.querySelectorAll(`[data-slot="${n}"]`));return s.length>0?s.forEach(o=>o.parentElement?.replaceChild(a,o)):Array.from(e.querySelectorAll(`slot[name="${n}"]`)).forEach(i=>i.parentElement?.replaceChild(a,i)),!0}})}function W(e,t,n){let r=n||{targets:new WeakMap,path:[]};if(e!==void 0)return new Proxy(e,{set(a,s,o){return typeof s=="string"&&console.error(`State is read-only for web components. Unable to set '${s}'.`),!1},get(a,s,o){let i=Reflect.get(a,s,o),l=s==="__proto__";if(typeof s=="string"&&!l&&(r.targets.has(a)||(r.targets.set(a,r.path.join(".")),r.path.push(s))),l||Array.isArray(i)||E(i))return W(i,t,r);let c=r.targets.get(a)??"";return typeof c=="string"&&typeof s=="string"&&(Array.isArray(a)||(c+=c!==""?`.${s}`:s),t.indexOf(c)===-1&&t.push(c)),r.path.length=0,r.path.push(c),i}})}function ue(e){return()=>{let t=e.internal.updates,n=new Set,r=a=>{if(a)for(let s=0;s<a.length;s++){let o=a[s];if(!n.has(o)){n.add(o);try{o(e.app)}catch{}}}};for(let a=0;a<t.path.length;a++){let s=t.path[a],o=s.slice(s.indexOf(".")+1);r(t.subscribers.get(o));for(let[i,l]of t.subscribers.entries()){if(i===o)continue;let c=`${i}.`,f=`${o}.`;(o.startsWith(c)||i.startsWith(f))&&r(l)}}t.path=[],t.value=[],t.raf=void 0}}function re(e){let t=e.internal,n=e;if(n===void 0)return e;let r=new WeakSet,a=Symbol("boredom-proxy");function s(i,l){if(r.has(i))return i;let c=new Proxy(i,{get(f,d,u){return d===a?!0:Reflect.get(f,d,u)},set(f,d,u){if(!(f[d]!==u))return!0;if(typeof d=="string"){let M=Array.isArray(i)?l:`${l}.${d}`;!(u&&u[a]===!0)&&(Array.isArray(u)||E(u))&&(u=o(u,M))}return Reflect.set(f,d,u),typeof d!="string"||(Array.isArray(i)?t.updates.path.push(`${l}`):t.updates.path.push(`${l}.${d}`),t.updates.value.push(f),t.updates.raf||(t.updates.raf=requestAnimationFrame(ue(e)))),!0}});return r.add(i),r.add(c),c}function o(i,l){if(!Array.isArray(i)&&!E(i)||r.has(i)||i&&i[a]===!0)return i;if(Array.isArray(i))for(let c=0;c<i.length;c++){let f=i[c];(Array.isArray(f)||E(f))&&(i[c]=o(f,l))}else for(let c of Object.keys(i)){let f=i[c];(Array.isArray(f)||E(f))&&(i[c]=o(f,`${l}.${c}`))}return s(i,l)}return ee(e,["internal"]).forEach(({path:i,value:l})=>{if(Array.isArray(l)||E(l)&&!r.has(l)){let f=i.join("."),d=Z(i.slice(0,-1),n);if(d===l)return;d[i.at(-1)]=s(l,f)}}),e}function oe(e){let t=e.internal.customTags.filter(r=>document.querySelector(r)!==null),n=e.internal.components;for(let[r,a]of n.entries()){if(a===null||!t.includes(r))continue;let s=Array.from(document.querySelectorAll(r)).filter(o=>D(o));s.length!==0&&s.forEach((o,i)=>{a(e,{index:i,name:r,data:void 0})(o)})}}function I(e,t,n){let r=t.internal.components.get(e);if(r){let a={...n,tagName:e};return H(e,r(t,a))}return H(e)}var x={console:!0,globals:!0,errorBoundary:!0,visualIndicators:!0,errorHistory:!0,versionLog:!0,api:!0},w=new Map,y=null;function p(e){return e==="errorBoundary"?x.errorBoundary??!0:!1}function U(e){if(typeof e=="boolean"){let t=e;x={console:t,globals:t,errorBoundary:!0,visualIndicators:t,errorHistory:t,versionLog:t,api:t}}else x={...x,...e}}function pe(){return{...x}}function me(){}function ie(e,t){console.error(`[boreDOM] Render error in <${e}>: ${t.message}`)}function j(e){e?(w.delete(e),y?.component===e&&(y=null)):y&&(w.delete(y.component),y=null)}function P(e){e.removeAttribute("data-boredom-error")}function ye(e){let t=e?w.get(e):y;if(!t)return null;try{return{component:t.component,state:JSON.parse(JSON.stringify(t.state)),timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}catch{return{component:t.component,state:"[Unable to serialize - contains circular references or functions]",timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}}var S={get errors(){return w},get lastError(){return y},rerender(e){let t=e?w.get(e):y;t?t.rerender():console.warn("[boreDOM] No error context found to rerender")},clearError(e){let t=e?w.get(e):y;t&&(P(t.element),j(e),void 0)},export:ye,get config(){return pe()}};var N=Symbol("boreDOM.webComponent"),A=null,G=null,q=null,ge=new WeakMap;function se(e,t,n){A=e,t&&(G=t),n&&(q=n)}function be(e){return typeof e=="function"&&e[N]===!0}function he(e,t,n){console.warn("[boreDOM] define() is not available in production build")}function Ee(e,t){if(!A)return;Array.from(document.querySelectorAll(e)).forEach((r,a)=>{if(r instanceof HTMLElement&&"renderCallback"in r){let o=t(A,{index:a,name:e,data:void 0});r.renderCallback=o,o(r)}})}function Se(e,t=0){}function Ce(e){return null}var O={define:he,operate:Se,exportComponent:Ce};var L="0.25.25";var ae=!1,xe={get errors(){return S.errors},get lastError(){return S.lastError},rerender:S.rerender,clearError:S.clearError,export:S.export,get config(){return S.config},version:L,define:O.define,operate:O.operate,exportComponent:O.exportComponent};typeof window<"u"&&(window.boreDOM=xe);async function et(e,t,n){n?.debug!==void 0&&U(n.debug),!ae&&p("versionLog")&&(ae=!0,typeof console<"u"&&typeof console.info=="function"&&console.info(`[boreDOM] v${L}`));let r=Q(),a=await J(r);if(t)for(let i of Object.keys(t))a.set(i,t[i]);let o=re({app:e,internal:{customTags:r,components:a,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return o.internal.updates.path=[],o.internal.updates.value=[],o.internal.updates.raf&&(cancelAnimationFrame(o.internal.updates.raf),o.internal.updates.raf=void 0),se(o,we,R),oe(o),o.app}function we(e){let t=null,n,r=(a,s)=>o=>{let{internal:i,app:l}=a,c=[],f=W(l,c),d=ne(o),u=v(o),F=te(o,l,s);if(t!==o){let M=async()=>{let g=i.updates.subscribers;for(let b of c){let m=g.get(b);m?m.includes(n)||m.push(n):g.set(b,[n])}},_;try{_=e({detail:s,state:f,refs:d,on:F,self:o})}catch(g){let b=g;p("console")&&(s?.name??o.tagName.toLowerCase(),void 0),_=()=>{}}n=g=>{let b=s?.name??o.tagName.toLowerCase();if(p("errorBoundary"))try{_({state:g,refs:d,slots:u,self:o,detail:s,makeComponent:(m,h)=>I(m,a,h?.detail)}),M(),P(o),j(b)}catch(m){let h=m,T={component:b,element:o,error:h,state:l,refs:d,slots:u,timestamp:Date.now(),rerender:()=>n(g),stack:h.stack??""};p("console")?void 0:ie(b,h)}else _({state:g,refs:d,slots:u,self:o,detail:s,makeComponent:(m,h)=>I(m,a,h?.detail)}),M()}}n(f),t=o};return r[N]=!0,r}export{L as VERSION,xe as boreDOM,me as clearGlobals,et as inflictBoreDOM,p as isDebugEnabled,le as queryComponent,R as registerComponent,U as setDebugConfig,we as webComponent};
