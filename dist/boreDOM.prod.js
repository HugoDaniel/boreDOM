var P=async e=>{let t=new Map;for(let r=0;r<e.length;++r){let s=Array.from(q("script[src]")).find(o=>((o.getAttribute("src")??"").split("/").pop()??"")===`${e[r]}.js`)?.getAttribute("src"),i=null;if(s)try{let l=await import(new URL(s,document.baseURI).href);for(let c of Object.keys(l)){i=l[c];break}t.set(e[r],i)}catch(o){console.error(`Unable to import "${s}"`,o)}}return t},U=()=>Array.from(q("template[data-component]")).filter(e=>e instanceof HTMLElement).map(e=>{let t={name:"",attributes:[]};for(let r in e.dataset)r==="component"?t.name=e.dataset[r]??"":t.attributes.push([te(r),e.dataset[r]??""]);if(t.name==="")throw new Error(`A <template> was found with an invalid data-component: "${e.dataset.component}"`);return t}).map(({name:e,attributes:t})=>(ne(e,{attributes:t}),e)),k=(e,t)=>{let r=w(e);if(!_(r)){let n=`The tag name "${e}" is not a BoreDOM  component.
      
"createComponent" only accepts tag-names with matching <template> tags that have a data-component attribute in them.`;throw console.error(n),new Error(n)}return t&&(r.renderCallback=t),r},Z=e=>{let t=N(e);if(!(t===null||!_(t)))return t},N=e=>document.querySelector(e),q=e=>document.querySelectorAll(e),w=(e,t)=>{let r=document.createElement(e);return t&&Array.isArray(t)&&t.length>0&&t.map(n=>r.appendChild(n)),r};var ee=(e,t)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(e,{detail:t}))):dispatchEvent(new CustomEvent(e,{detail:t}))};var G=e=>typeof e=="object",I=e=>typeof e=="function",_=e=>G(e)&&"isBored"in e&&!!e.isBored;var te=e=>{if(e===""||!e.split("").some(r=>r!==r.toLowerCase()))return e;let t="";for(let r=0;r<e.length;r++){let n=e[r];n===n.toUpperCase()&&r!==0&&(t+="-"),t+=n.toLowerCase()}return t};var T=e=>e.startsWith("on"),re=e=>e.startsWith("queriedOn"),D=e=>T(e)?e.slice(2).toLowerCase():e.slice(9).toLowerCase(),$=class extends HTMLElement{},ne=(e,t={})=>{customElements.get(e)||customElements.define(e,class extends ${static get observedAttributes(){return typeof t.attributeChangedCallback=="object"?Object.keys(t.attributeChangedCallback):[]}constructor(){super()}isBored=!0;traverse(r,{traverseShadowRoot:n,query:a}={}){Array.from(n?this.shadowRoot?.querySelectorAll(a??"*")??[]:[]).concat(Array.from(this.querySelectorAll(a??"*"))).filter(s=>s instanceof HTMLElement).forEach(r)}#e(r){return r.split("'").filter(n=>n.length>2&&!(n.includes("(")||n.includes(",")||n.includes(")")))}#t(){let r;this.traverse(n=>{if(n instanceof HTMLElement){customElements.get(n.tagName.toLowerCase())&&(r=n);for(let s=0;s<n.attributes.length;s++){let i=n.attributes[s];if(T(i.name)){let o=this.#e(i.value);o.length>0&&o.forEach(l=>{n.addEventListener(D(i.name),c=>ee(l,{event:c,dispatcher:n,component:this,index:this.parentElement?Array.from(this.parentElement.children).indexOf(this):-1}))}),n.setAttribute(`data-${i.name}-dispatches`,o.join()),n.removeAttribute(i.name)}}}},{traverseShadowRoot:!0})}isInitialized=!1;#r(){let r=N(`[data-component="${e}"]`)??w("template"),n=r.getAttribute("shadowrootmode");if(t.style||t.shadow||n){let s=t.shadowrootmode??n??"open",i=this.attachShadow({mode:s});if(t.style){let o=w("style");o.textContent=t.style,i.appendChild(o)}if(t.shadow){let o=w("template");o.innerHTML=t.shadow,i.appendChild(o.content.cloneNode(!0))}else n&&i.appendChild(r.content.cloneNode(!0))}r&&!n&&this.appendChild(r.content.cloneNode(!0)),t.onSlotChange&&this.traverse(s=>{s instanceof HTMLSlotElement&&s.addEventListener("slotchange",i=>t.onSlotChange?.(i))},{traverseShadowRoot:!0}),I(t.onClick)&&this.addEventListener("click",t.onClick);for(let[s,i]of Object.entries(t))if(T(s)){if(!I(i))continue;this.addEventListener(D(s),i)}else if(re(s)){let o=i;if(!G(o))continue;let l=D(s);for(let[c,f]of Object.entries(o))this.traverse(d=>{d.addEventListener(l,f)},{traverseShadowRoot:!0,query:c})}t.attributes&&Array.isArray(t.attributes)&&t.attributes.map(([s,i])=>this.setAttribute(s,i)),this.#t(),this.isInitialized=!0}renderCallback=r=>{};connectedCallback(){this.isInitialized||this.#r(),this.renderCallback(this),t.connectedCallback?.(this)}slots=M(this);updateSlot(r,n,a){document.createElement(a).setAttribute("slot",r)}disconnectedCallback(){t.disconnectedCallback?.(this)}adoptedCallback(){t.adoptedCallback?.(this)}attributeChangedCallback(r,n,a){t.attributeChangedCallback&&t.attributeChangedCallback[r]({element:this,name:r,oldValue:n,newValue:a})}})};function F(e,t){let r=t;return t===null||e.forEach(n=>{r=r[n]}),r}function z(e,t=[]){let r=[{path:[],obj:e}],n=[];for(;r.length>0;){let{path:a,obj:s}=r.pop();for(let i in s){if(t.includes(i))continue;let o=s[i],l=a.concat(i);typeof o=="object"&&o!==null&&r.push({path:l,obj:o}),n.push({path:l,value:o})}}return n}function b(e){if(e==null||typeof e!="object")return!1;let t=Object.getPrototypeOf(e);return t==null?!0:t===Object.prototype}function Q(e,t,r){return(n,a)=>{addEventListener(n,s=>{let i=s?.detail?.event.currentTarget,o;for(;i;){if(i===e){try{let l=a({state:t,e:s.detail,detail:r});Promise.resolve(l).catch(c=>{console.error(`Error in async handler for "${n}" event`,c)})}catch(l){console.error(`Error in handler for "${n}" event`,l)}return}i instanceof HTMLElement?i=i.parentElement:i=void 0}})}}function J(e){return new Proxy({},{get(t,r,n){let a=new Error(`Ref "${String(r)}" not found in <${e.tagName}>`);if(typeof r=="string"){let s=e.querySelectorAll(`[data-ref="${r}"]`);if(!s)throw a;let i=Array.from(s).filter(o=>o instanceof HTMLElement);if(i.length===0)throw a;return i.length===1?i[0]:i}}})}function M(e){return new Proxy({},{get(t,r,n){let a=new Error(`Slot "${String(r)}" not found in <${e.tagName}>`);if(typeof r=="string"){let s=e.querySelectorAll(`slot[name="${r}"]`);if(!s)throw a;let i=Array.from(s).filter(o=>o instanceof HTMLSlotElement);if(i.length===0)throw a;return i.length===1?i[0]:i}},set(t,r,n){if(typeof r!="string")return!1;let a=n;if(n instanceof HTMLElement)n.setAttribute("data-slot",r);else if(typeof n=="string")a=w("span"),a.setAttribute("data-slot",r),a.innerText=n;else throw new Error(`Invalid value for slot ${r} in <${e.tagName}>`);let s=Array.from(e.querySelectorAll(`[data-slot="${r}"]`));return s.length>0?s.forEach(i=>i.parentElement?.replaceChild(a,i)):Array.from(e.querySelectorAll(`slot[name="${r}"]`)).forEach(o=>o.parentElement?.replaceChild(a,o)),!0}})}function B(e,t,r){let n=r||{targets:new WeakMap,path:[]};if(e!==void 0)return new Proxy(e,{set(a,s,i){return typeof s=="string"&&console.error(`State is read-only for web components. Unable to set '${s}'.`),!1},get(a,s,i){let o=Reflect.get(a,s,i),l=s==="__proto__";if(typeof s=="string"&&!l&&(n.targets.has(a)||(n.targets.set(a,n.path.join(".")),n.path.push(s))),l||Array.isArray(o)||b(o))return B(o,t,n);let c=n.targets.get(a)??"";return typeof c=="string"&&typeof s=="string"&&(Array.isArray(a)||(c+=c!==""?`.${s}`:s),t.indexOf(c)===-1&&t.push(c)),n.path.length=0,n.path.push(c),o}})}function oe(e){return()=>{let t=e.internal.updates,r=new Set,n=a=>{if(a)for(let s=0;s<a.length;s++){let i=a[s];if(!r.has(i)){r.add(i);try{i(e.app)}catch{}}}};for(let a=0;a<t.path.length;a++){let s=t.path[a],i=s.slice(s.indexOf(".")+1);n(t.subscribers.get(i));for(let[o,l]of t.subscribers.entries()){if(o===i)continue;let c=`${o}.`,f=`${i}.`;(i.startsWith(c)||o.startsWith(f))&&n(l)}}t.path=[],t.value=[],t.raf=void 0}}function K(e){let t=e.internal,r=e;if(r===void 0)return e;let n=new WeakSet,a=Symbol("boredom-proxy");function s(o,l){if(n.has(o))return o;let c=new Proxy(o,{get(f,d,u){return d===a?!0:Reflect.get(f,d,u)},set(f,d,u){if(!(f[d]!==u))return!0;if(typeof d=="string"){let C=Array.isArray(o)?l:`${l}.${d}`;!(u&&u[a]===!0)&&(Array.isArray(u)||b(u))&&(u=i(u,C))}return Reflect.set(f,d,u),typeof d!="string"||(Array.isArray(o)?t.updates.path.push(`${l}`):t.updates.path.push(`${l}.${d}`),t.updates.value.push(f),t.updates.raf||(t.updates.raf=requestAnimationFrame(oe(e)))),!0}});return n.add(o),n.add(c),c}function i(o,l){if(!Array.isArray(o)&&!b(o)||n.has(o)||o&&o[a]===!0)return o;if(Array.isArray(o))for(let c=0;c<o.length;c++){let f=o[c];(Array.isArray(f)||b(f))&&(o[c]=i(f,l))}else for(let c of Object.keys(o)){let f=o[c];(Array.isArray(f)||b(f))&&(o[c]=i(f,`${l}.${c}`))}return s(o,l)}return z(e,["internal"]).forEach(({path:o,value:l})=>{if(Array.isArray(l)||b(l)&&!n.has(l)){let f=o.join("."),d=F(o.slice(0,-1),r);if(d===l)return;d[o.at(-1)]=s(l,f)}}),e}function V(e){let t=e.internal.customTags.filter(n=>document.querySelector(n)!==null),r=e.internal.components;for(let[n,a]of r.entries()){if(a===null||!t.includes(n))continue;let s=Array.from(document.querySelectorAll(n)).filter(i=>_(i));s.length!==0&&s.forEach((i,o)=>{a(e,{index:o,name:n,data:void 0})(i)})}}function H(e,t,r){let n=t.internal.components.get(e);if(n){let a={...r,tagName:e};return k(e,n(t,a))}return k(e)}var x={console:!0,globals:!0,errorBoundary:!0,visualIndicators:!0,errorHistory:!0,versionLog:!0},A=new Map,g=null;function E(e){return e==="errorBoundary"?x.errorBoundary??!0:!1}function R(e){if(typeof e=="boolean"){let t=e;x={console:t,globals:t,errorBoundary:!0,visualIndicators:t,errorHistory:t,versionLog:t}}else x={...x,...e}}function se(){return{...x}}function ie(){}function X(e,t){console.error(`[boreDOM] Render error in <${e}>: ${t.message}`)}function j(e){e?(A.delete(e),g?.component===e&&(g=null)):g&&(A.delete(g.component),g=null)}function W(e){e.removeAttribute("data-boredom-error")}function ae(e){let t=e?A.get(e):g;if(!t)return null;try{return{component:t.component,state:JSON.parse(JSON.stringify(t.state)),timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}catch{return{component:t.component,state:"[Unable to serialize - contains circular references or functions]",timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}}var S={get errors(){return A},get lastError(){return g},rerender(e){let t=e?A.get(e):g;t?t.rerender():console.warn("[boreDOM] No error context found to rerender")},clearError(e){let t=e?A.get(e):g;t&&(W(t.element),j(e),void 0)},export:ae,get config(){return se()}};var v="0.25.25";var Y=!1,le={get errors(){return S.errors},get lastError(){return S.lastError},rerender:S.rerender,clearError:S.clearError,export:S.export,get config(){return S.config},version:v};typeof window<"u"&&(window.boreDOM=le);async function He(e,t,r){r?.debug!==void 0&&R(r.debug),!Y&&E("versionLog")&&(Y=!0,typeof console<"u"&&typeof console.info=="function"&&console.info(`[boreDOM] v${v}`));let n=U(),a=await P(n);if(t)for(let o of Object.keys(t))a.set(o,t[o]);let i=K({app:e,internal:{customTags:n,components:a,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return i.internal.updates.path=[],i.internal.updates.value=[],i.internal.updates.raf&&(cancelAnimationFrame(i.internal.updates.raf),i.internal.updates.raf=void 0),V(i),i.app}function Re(e){let t=null,r;return(n,a)=>s=>{let{internal:i,app:o}=n,l=[],c=B(o,l),f=J(s),d=M(s),u=Q(s,o,a);if(t!==s){let L=async()=>{let m=i.updates.subscribers;for(let y of l){let p=m.get(y);p?p.includes(r)||p.push(r):m.set(y,[r])}},C;try{C=e({detail:a,state:c,refs:f,on:u,self:s})}catch(m){let y=m;E("console")&&(a?.name??s.tagName.toLowerCase(),void 0),C=()=>{}}r=m=>{let y=a?.name??s.tagName.toLowerCase();if(E("errorBoundary"))try{C({state:m,refs:f,slots:d,self:s,detail:a,makeComponent:(p,h)=>H(p,n,h?.detail)}),L(),W(s),j(y)}catch(p){let h=p,O={component:y,element:s,error:h,state:o,refs:f,slots:d,timestamp:Date.now(),rerender:()=>r(m),stack:h.stack??""};E("console")?void 0:X(y,h)}else C({state:m,refs:f,slots:d,self:s,detail:a,makeComponent:(p,h)=>H(p,n,h?.detail)}),L()}}r(c),t=s}}export{v as VERSION,le as boreDOM,ie as clearGlobals,He as inflictBoreDOM,E as isDebugEnabled,Z as queryComponent,R as setDebugConfig,Re as webComponent};
