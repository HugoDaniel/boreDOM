var F=async e=>{let t=new Map;for(let n=0;n<e.length;++n){let s=Array.from(K("script[src]")).find(i=>((i.getAttribute("src")??"").split("/").pop()??"")===`${e[n]}.js`)?.getAttribute("src"),r=null;if(s)try{let l=await import(new URL(s,document.baseURI).href);for(let c of Object.keys(l)){r=l[c];break}t.set(e[n],r)}catch(i){console.error(`Unable to import "${s}"`,i)}}return t},J=()=>Array.from(K("template[data-component]")).filter(e=>e instanceof HTMLElement).map(e=>{let t={name:"",attributes:[]};for(let n in e.dataset)n==="component"?t.name=e.dataset[n]??"":t.attributes.push([fe(n),e.dataset[n]??""]);if(t.name==="")throw new Error(`A <template> was found with an invalid data-component: "${e.dataset.component}"`);return t}).map(({name:e,attributes:t})=>(X(e,{attributes:t}),e)),H=(e,t)=>{let n=S(e);if(!A(n)){let o=`The tag name "${e}" is not a BoreDOM  component.
      
"createComponent" only accepts tag-names with matching <template> tags that have a data-component attribute in them.`;throw console.error(o),new Error(o)}return t&&(n.renderCallback=t),n},le=e=>{let t=Q(e);if(!(t===null||!A(t)))return t},Q=e=>document.querySelector(e),K=e=>document.querySelectorAll(e),S=(e,t)=>{let n=document.createElement(e);return t&&Array.isArray(t)&&t.length>0&&t.map(o=>n.appendChild(o)),n};var ce=(e,t)=>{document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>dispatchEvent(new CustomEvent(e,{detail:t}))):dispatchEvent(new CustomEvent(e,{detail:t}))};var V=e=>typeof e=="object",z=e=>typeof e=="function",A=e=>V(e)&&"isBored"in e&&!!e.isBored;var fe=e=>{if(e===""||!e.split("").some(n=>n!==n.toLowerCase()))return e;let t="";for(let n=0;n<e.length;n++){let o=e[n];o===o.toUpperCase()&&n!==0&&(t+="-"),t+=o.toLowerCase()}return t};var B=e=>e.startsWith("on"),de=e=>e.startsWith("queriedOn"),$=e=>B(e)?e.slice(2).toLowerCase():e.slice(9).toLowerCase(),k=class extends HTMLElement{},X=(e,t={})=>{customElements.get(e)||customElements.define(e,class extends k{static get observedAttributes(){return typeof t.attributeChangedCallback=="object"?Object.keys(t.attributeChangedCallback):[]}constructor(){super()}isBored=!0;traverse(n,{traverseShadowRoot:o,query:a}={}){Array.from(o?this.shadowRoot?.querySelectorAll(a??"*")??[]:[]).concat(Array.from(this.querySelectorAll(a??"*"))).filter(s=>s instanceof HTMLElement).forEach(n)}#e(n){return n.split("'").filter(o=>o.length>2&&!(o.includes("(")||o.includes(",")||o.includes(")")))}#t(){let n;this.traverse(o=>{if(o instanceof HTMLElement){customElements.get(o.tagName.toLowerCase())&&(n=o);for(let s=0;s<o.attributes.length;s++){let r=o.attributes[s];if(B(r.name)){let i=this.#e(r.value);i.length>0&&i.forEach(l=>{o.addEventListener($(r.name),c=>ce(l,{event:c,dispatcher:o,component:this,index:this.parentElement?Array.from(this.parentElement.children).indexOf(this):-1}))}),o.setAttribute(`data-${r.name}-dispatches`,i.join()),o.removeAttribute(r.name)}}}},{traverseShadowRoot:!0})}isInitialized=!1;#n(){let n=Q(`[data-component="${e}"]`)??S("template"),o=n.getAttribute("shadowrootmode");if(t.style||t.shadow||o){let s=t.shadowrootmode??o??"open",r=this.attachShadow({mode:s});if(t.style){let i=S("style");i.textContent=t.style,r.appendChild(i)}if(t.shadow){let i=S("template");i.innerHTML=t.shadow,r.appendChild(i.content.cloneNode(!0))}else o&&r.appendChild(n.content.cloneNode(!0))}n&&!o&&this.appendChild(n.content.cloneNode(!0)),t.onSlotChange&&this.traverse(s=>{s instanceof HTMLSlotElement&&s.addEventListener("slotchange",r=>t.onSlotChange?.(r))},{traverseShadowRoot:!0}),z(t.onClick)&&this.addEventListener("click",t.onClick);for(let[s,r]of Object.entries(t))if(B(s)){if(!z(r))continue;this.addEventListener($(s),r)}else if(de(s)){let i=r;if(!V(i))continue;let l=$(s);for(let[c,f]of Object.entries(i))this.traverse(d=>{d.addEventListener(l,f)},{traverseShadowRoot:!0,query:c})}t.attributes&&Array.isArray(t.attributes)&&t.attributes.map(([s,r])=>this.setAttribute(s,r)),this.#t(),this.isInitialized=!0}renderCallback=n=>{};connectedCallback(){this.isInitialized||this.#n(),this.renderCallback(this),t.connectedCallback?.(this)}slots=M(this);updateSlot(n,o,a){document.createElement(a).setAttribute("slot",n)}disconnectedCallback(){t.disconnectedCallback?.(this)}adoptedCallback(){t.adoptedCallback?.(this)}attributeChangedCallback(n,o,a){t.attributeChangedCallback&&t.attributeChangedCallback[n]({element:this,name:n,oldValue:o,newValue:a})}})},R=e=>{X(e,{})};function Y(e,t){let n=t;return t===null||e.forEach(o=>{n=n[o]}),n}function Z(e,t=[]){let n=[{path:[],obj:e}],o=[],a=new WeakSet;for(;n.length>0;){let{path:s,obj:r}=n.pop();if(!a.has(r)){a.add(r);for(let i in r){if(t.includes(i))continue;let l=r[i],c=s.concat(i);typeof l=="object"&&l!==null&&!a.has(l)&&n.push({path:c,obj:l}),o.push({path:c,value:l})}}}return o}function h(e){if(e==null||typeof e!="object")return!1;let t=Object.getPrototypeOf(e);return t==null?!0:t===Object.prototype}function ee(e,t,n){return(o,a)=>{addEventListener(o,s=>{let r=s?.detail?.event.currentTarget,i;for(;r;){if(r===e){try{let l=a({state:t,e:s.detail,detail:n});Promise.resolve(l).catch(c=>{console.error(`Error in async handler for "${o}" event`,c)})}catch(l){console.error(`Error in handler for "${o}" event`,l)}return}r instanceof HTMLElement?r=r.parentElement:r=void 0}})}}function te(e){return new Proxy({},{get(t,n,o){let a=new Error(`Ref "${String(n)}" not found in <${e.tagName}>`);if(typeof n=="string"){let s=e.querySelectorAll(`[data-ref="${n}"]`);if(!s)throw a;let r=Array.from(s).filter(i=>i instanceof HTMLElement);if(r.length===0)throw a;return r.length===1?r[0]:r}}})}function M(e){return new Proxy({},{get(t,n,o){let a=new Error(`Slot "${String(n)}" not found in <${e.tagName}>`);if(typeof n=="string"){let s=e.querySelectorAll(`slot[name="${n}"]`);if(!s)throw a;let r=Array.from(s).filter(i=>i instanceof HTMLSlotElement);if(r.length===0)throw a;return r.length===1?r[0]:r}},set(t,n,o){if(typeof n!="string")return!1;let a=o;if(o instanceof HTMLElement)o.setAttribute("data-slot",n);else if(typeof o=="string")a=S("span"),a.setAttribute("data-slot",n),a.innerText=o;else throw new Error(`Invalid value for slot ${n} in <${e.tagName}>`);let s=Array.from(e.querySelectorAll(`[data-slot="${n}"]`));return s.length>0?s.forEach(r=>r.parentElement?.replaceChild(a,r)):Array.from(e.querySelectorAll(`slot[name="${n}"]`)).forEach(i=>i.parentElement?.replaceChild(a,i)),!0}})}function U(e,t,n){let o=n||{targets:new WeakMap,path:[]};if(e!==void 0)return new Proxy(e,{set(a,s,r){return typeof s=="string"&&console.error(`State is read-only for web components. Unable to set '${s}'.`),!1},get(a,s,r){let i=Reflect.get(a,s,r),l=s==="__proto__";if(typeof s=="string"&&!l&&(o.targets.has(a)||(o.targets.set(a,o.path.join(".")),o.path.push(s))),l||Array.isArray(i)||h(i))return U(i,t,o);let c=o.targets.get(a)??"";return typeof c=="string"&&typeof s=="string"&&(Array.isArray(a)||(c+=c!==""?`.${s}`:s),t.indexOf(c)===-1&&t.push(c)),o.path.length=0,o.path.push(c),i}})}function ue(e){return()=>{let t=e.internal.updates,n=new Set,o=a=>{if(a)for(let s=0;s<a.length;s++){let r=a[s];if(!n.has(r)){n.add(r);try{r(e.app)}catch{}}}};for(let a=0;a<t.path.length;a++){let s=t.path[a],r=s.slice(s.indexOf(".")+1);o(t.subscribers.get(r));for(let[i,l]of t.subscribers.entries()){if(i===r)continue;let c=`${i}.`,f=`${r}.`;(r.startsWith(c)||i.startsWith(f))&&o(l)}}t.path=[],t.value=[],t.raf=void 0}}function ne(e){let t=e.internal,n=e;if(n===void 0)return e;let o=new WeakSet,a=Symbol("boredom-proxy");function s(i,l){if(o.has(i))return i;let c=new Proxy(i,{get(f,d,p){return d===a?!0:Reflect.get(f,d,p)},set(f,d,p){if(!(f[d]!==p))return!0;if(typeof d=="string"){let _=Array.isArray(i)?l:`${l}.${d}`;!(p&&p[a]===!0)&&(Array.isArray(p)||h(p))&&(p=r(p,_))}return Reflect.set(f,d,p),typeof d!="string"||(Array.isArray(i)?t.updates.path.push(`${l}`):t.updates.path.push(`${l}.${d}`),t.updates.value.push(f),t.updates.raf||(t.updates.raf=requestAnimationFrame(ue(e)))),!0}});return o.add(i),o.add(c),c}function r(i,l){if(!Array.isArray(i)&&!h(i)||o.has(i)||i&&i[a]===!0)return i;if(Array.isArray(i))for(let c=0;c<i.length;c++){let f=i[c];(Array.isArray(f)||h(f))&&(i[c]=r(f,l))}else for(let c of Object.keys(i)){let f=i[c];(Array.isArray(f)||h(f))&&(i[c]=r(f,`${l}.${c}`))}return s(i,l)}return Z(e,["internal"]).forEach(({path:i,value:l})=>{if(Array.isArray(l)||h(l)&&!o.has(l)){let f=i.join("."),d=Y(i.slice(0,-1),n);if(d===l)return;d[i.at(-1)]=s(l,f)}}),e}function re(e){let t=e.internal.customTags.filter(o=>document.querySelector(o)!==null),n=e.internal.components;for(let[o,a]of n.entries()){if(a===null||!t.includes(o))continue;let s=Array.from(document.querySelectorAll(o)).filter(r=>A(r));s.length!==0&&s.forEach((r,i)=>{a(e,{index:i,name:o,data:void 0})(r)})}}function W(e,t,n){let o=t.internal.components.get(e);if(o){let a={...n,tagName:e};return H(e,o(t,a))}return H(e)}var C={console:!0,globals:!0,errorBoundary:!0,visualIndicators:!0,errorHistory:!0,versionLog:!0,api:!0},D=new Map,O=null;function u(e){return e==="errorBoundary"?C.errorBoundary??!0:!1}function I(e){if(typeof e=="boolean"){let t=e;C={console:t,globals:t,errorBoundary:!0,visualIndicators:t,errorHistory:t,versionLog:t,api:t}}else C={...C,...e}}function pe(){return{...C}}function me(){}function oe(e,t){console.error(`[boreDOM] Render error in <${e}>: ${t.message}`)}function G(e){e.removeAttribute("data-boredom-error")}function ye(e){let t=e?D.get(e):O;if(!t)return null;try{return{component:t.component,state:JSON.parse(JSON.stringify(t.state)),timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}catch(n){return u("console")&&console.warn(`[boreDOM] exportState: Unable to serialize state for <${t.component}>:`,n instanceof Error?n.message:n),{component:t.component,state:"[Unable to serialize - contains circular references or functions]",timestamp:new Date(t.timestamp).toISOString(),error:t.error.message}}}var E={get errors(){return D},get lastError(){return O},rerender(e){let t=e?D.get(e):O;t?t.rerender():console.warn("[boreDOM] No error context found to rerender")},clearError(e){let t=e?D.get(e):O;t?(G(t.element),void 0):u("console")&&console.warn(e?`[boreDOM] clearError: No error found for <${e}>`:"[boreDOM] clearError: No error to clear")},export:ye,get config(){return pe()}};var q=Symbol("boreDOM.webComponent"),w=null,P=null,j=null,ge=new WeakMap;function ie(e,t,n){w=e,t&&(P=t),n&&(j=n)}function be(e){return typeof e=="function"&&e[q]===!0}function he(e,t,n){return console.warn("[boreDOM] define() is not available in production build"),!1}function Ee(e,t){if(!w)return;let n=Array.from(document.querySelectorAll(e)),o={count:0};n.forEach((a,s)=>{if(a instanceof HTMLElement&&"renderCallback"in a)try{let i=t(w,{index:s,name:e,data:void 0});a.renderCallback=i,i(a)}catch(r){o.count++,u("console")&&console.error(`[boreDOM] Failed to initialize <${e}> instance ${s}:`,r)}}),o.count>0&&u("console")&&console.warn(`[boreDOM] ${o.count} of ${n.length} <${e}> instances failed to initialize`)}function se(e,t=0){console.warn("[boreDOM] operate() is not available in production build")}function Se(e){return console.warn("[boreDOM] exportComponent() is not available in production build"),null}var v={define:he,operate:se,exportComponent:Se};var L="0.25.25";var ae=!1,Ce={get errors(){return E.errors},get lastError(){return E.lastError},rerender:E.rerender,clearError:E.clearError,export:E.export,get config(){return E.config},version:L,define:v.define,operate:v.operate,exportComponent:v.exportComponent};typeof window<"u"&&(window.boreDOM=Ce);async function et(e,t,n){n?.debug!==void 0&&I(n.debug),!ae&&u("versionLog")&&(ae=!0,typeof console<"u"&&typeof console.info=="function"&&console.info(`[boreDOM] v${L}`));let o=J(),a=await F(o);if(t)for(let i of Object.keys(t))a.set(i,t[i]);let r=ne({app:e,internal:{customTags:o,components:a,updates:{path:[],value:[],raf:void 0,subscribers:new Map}}});return r.internal.updates.path=[],r.internal.updates.value=[],r.internal.updates.raf&&(cancelAnimationFrame(r.internal.updates.raf),r.internal.updates.raf=void 0),ie(r,xe,R),re(r),r.app}function xe(e){let t=null,n,o=(a,s)=>r=>{let{internal:i,app:l}=a,c=[],f=U(l,c),d=te(r),p=M(r),N=ee(r,l,s);if(t!==r){let _=async()=>{let y=i.updates.subscribers;for(let g of c){let m=y.get(g);m?m.includes(n)||m.push(n):y.set(g,[n])}},x;try{x=e({detail:s,state:f,refs:d,on:N,self:r})}catch(y){let g=y;u("console")&&(s?.name??r.tagName.toLowerCase(),void 0),x=()=>{}}n=y=>{let g=s?.name??r.tagName.toLowerCase();if(u("errorBoundary"))try{x({state:y,refs:d,slots:p,self:r,detail:s,makeComponent:(m,b)=>W(m,a,b?.detail)}),_(),G(r)}catch(m){let b=m,T={component:g,element:r,error:b,state:l,refs:d,slots:p,timestamp:Date.now(),rerender:()=>n(y),stack:b.stack??""};u("console")?void 0:oe(g,b)}else x({state:y,refs:d,slots:p,self:r,detail:s,makeComponent:(m,b)=>W(m,a,b?.detail)}),_()}}n(f),t=r};return o[q]=!0,o}export{L as VERSION,Ce as boreDOM,me as clearGlobals,et as inflictBoreDOM,u as isDebugEnabled,le as queryComponent,R as registerComponent,I as setDebugConfig,xe as webComponent};
